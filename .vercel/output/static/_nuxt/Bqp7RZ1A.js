import{f as Q,r as p,h as P,g as O,j as X,i as Y,c as d,a as e,x as m,b as Z,w as ee,m as a,p as u,v as b,z as E,F as w,y as M,s as se,t as y,q as S,_ as te,o as r,d as G,H as W}from"#entry";const ae={class:"p-6 space-y-4"},oe={class:"flex items-center justify-between"},le={key:0,class:"border rounded-md p-4 space-y-2"},ne={key:0,value:"ADMIN_MANAGER"},de=["value"],re={class:"overflow-x-auto"},ie={class:"min-w-full text-sm"},ue={class:"py-2 pr-4"},pe=["onUpdate:modelValue","disabled"],ce={class:"py-2 pr-4"},me=["onUpdate:modelValue","disabled"],ve={class:"py-2 pr-4"},fe={class:"py-2 pr-4"},be=["onUpdate:modelValue","disabled"],ye={key:0,value:"ADMIN"},_e={key:1,value:"ADMIN_MANAGER"},Ne={class:"py-2 pr-4"},xe=["onUpdate:modelValue","disabled"],Ae=["value"],ge={class:"py-2 pr-4"},he=["disabled","onClick"],Ee=["disabled","onClick"],we=["onClick"],Me={key:1,class:"fixed inset-0 bg-black/30 flex items-center justify-center"},Re={class:"bg-white rounded-md p-4 w-96 space-y-2"},Ie={class:"font-medium"},ke={key:0,class:"text-sm text-red-600"},Ue={class:"flex justify-end gap-2 pt-2"},Ve=["disabled"],Ce={key:2,class:"fixed inset-0 bg-black/30 flex items-center justify-center"},De={class:"bg-white rounded-md p-4 w-[520px] space-y-3"},Pe={class:"font-medium"},Oe={class:"space-y-2 max-h-80 overflow-auto"},Se={class:"flex items-center gap-2"},Ge=["onUpdate:modelValue"],We={class:"text-sm flex items-center gap-1"},$e=["onUpdate:modelValue","disabled"],Fe=Q({__name:"users",setup(Te){const o=p(null),N=p([]),k=P(()=>N.value.filter(l=>l.role==="MANAGER"||l.role==="ADMIN_MANAGER")),A=O({}),i=O({name:"",email:"",username:"",role:"USER",managerId:void 0});X(N,l=>{for(const t of l)A[t.id]=!0},{deep:!0});function R(l){return o.value?o.value.role==="OWNER"?!0:o.value.role==="ADMIN"?l.role!=="OWNER":o.value.role==="MANAGER"||o.value.role==="ADMIN_MANAGER"?l.managerId===o.value.id:!1:!1}function $(l){return o.value?o.value.role==="OWNER"?!0:o.value.role==="ADMIN"?l.role!=="OWNER":!1:!1}function T(l){return o.value?o.value.role==="OWNER"?!0:o.value.role==="ADMIN"?l.role!=="OWNER":o.value.role==="MANAGER"||o.value.role==="ADMIN_MANAGER"?l.managerId===o.value.id:o.value.id===l.id:!1}function j(l){return o.value?o.value.role==="OWNER"?!0:o.value.role==="ADMIN"?l.role!=="OWNER":!1:!1}async function U(){try{o.value=await $fetch("/api/auth/me")}catch{o.value=null}N.value=await $fetch("/api/users");for(const l of N.value)A[l.id]=!1}async function B(l){await $fetch("/api/users",{method:"PUT",body:{id:l.id,role:l.role,managerId:l.managerId,username:l.username,name:l.name}}),A[l.id]=!1}async function F(){await $fetch("/api/users",{method:"POST",body:{...i}}),i.name="",i.email="",i.username="",i.role="USER",i.managerId=void 0,await U()}Y(U);const v=p(null),f=p(""),x=p(""),g=p(""),V=P(()=>f.value.length>0&&f.value===x.value);function H(l){f.value="",x.value="",g.value="",v.value=l}function L(){v.value=null}async function q(){if(!V.value||!v.value){g.value="Passwords must match";return}await $fetch("/api/users/password",{method:"POST",body:{id:v.value.id,password:f.value}}),v.value=null}const _=p(null),h=p([]),c=p({});async function z(l){_.value=l;const t=await $fetch("/api/home-pages");h.value=t;const I=await Promise.all(t.map(async n=>{const D=(await $fetch(`/api/home-pages/permissions?homePageId=${n.id}`)).find(K=>K.userId===l.id);return{pageId:n.id,enabled:!!D,canEdit:D?.canEdit??!1}})),s={};for(const n of I)s[n.pageId]={enabled:n.enabled,canEdit:n.canEdit};c.value=s}function C(){_.value=null,h.value=[],c.value={}}async function J(){if(_.value){for(const l of h.value){const t=c.value[l.id]||{enabled:!1,canEdit:!1};await $fetch("/api/home-pages/permissions",{method:"POST",body:{homePageId:l.id,assignments:[{userId:_.value.id,enabled:t.enabled,canEdit:t.canEdit}]}})}C()}}return(l,t)=>{const I=te;return r(),d("div",ae,[e("div",oe,[t[8]||(t[8]=e("h1",{class:"text-2xl font-semibold"},"Users",-1)),Z(I,{to:"/",class:"underline"},{default:ee(()=>[...t[7]||(t[7]=[G("Back",-1)])]),_:1})]),a(o)&&(a(o).role==="ADMIN"||a(o).role==="OWNER")?(r(),d("div",le,[t[14]||(t[14]=e("h2",{class:"font-medium"},"Create User",-1)),e("form",{class:"grid gap-2 md:grid-cols-5",onSubmit:se(F,["prevent"])},[u(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>a(i).name=s),placeholder:"Name",class:"border rounded px-2 py-1"},null,512),[[b,a(i).name]]),u(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>a(i).email=s),placeholder:"Email",class:"border rounded px-2 py-1"},null,512),[[b,a(i).email]]),u(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>a(i).username=s),placeholder:"Username (optional)",class:"border rounded px-2 py-1"},null,512),[[b,a(i).username]]),u(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>a(i).role=s),class:"border rounded px-2 py-1"},[t[9]||(t[9]=e("option",{value:"USER"},"USER",-1)),t[10]||(t[10]=e("option",{value:"MANAGER"},"MANAGER",-1)),t[11]||(t[11]=e("option",{value:"ADMIN"},"ADMIN",-1)),a(o)&&a(o).role==="OWNER"?(r(),d("option",ne,"ADMIN_MANAGER")):m("",!0)],512),[[E,a(i).role]]),u(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>a(i).managerId=s),class:"border rounded px-2 py-1"},[t[12]||(t[12]=e("option",{value:void 0},"No Manager",-1)),(r(!0),d(w,null,M(a(k),s=>(r(),d("option",{key:s.id,value:s.id},"Manager: "+y(s.name),9,de))),128))],512),[[E,a(i).managerId,void 0,{number:!0}]]),t[13]||(t[13]=e("div",{class:"md:col-span-5"},[e("button",{class:"px-3 py-2 border rounded"},"Create")],-1))],32)])):m("",!0),e("div",re,[e("table",ie,[t[18]||(t[18]=e("thead",null,[e("tr",{class:"text-left border-b"},[e("th",{class:"py-2 pr-4"},"Username"),e("th",{class:"py-2 pr-4"},"Name"),e("th",{class:"py-2 pr-4"},"Email"),e("th",{class:"py-2 pr-4"},"Role"),e("th",{class:"py-2 pr-4"},"Manager"),e("th",{class:"py-2 pr-4"})])],-1)),e("tbody",null,[(r(!0),d(w,null,M(a(N),s=>(r(),d("tr",{key:s.id,class:"border-b"},[e("td",ue,[u(e("input",{"onUpdate:modelValue":n=>s.username=n,disabled:!R(s),class:"border rounded px-2 py-1 w-40"},null,8,pe),[[b,s.username]])]),e("td",ce,[u(e("input",{"onUpdate:modelValue":n=>s.name=n,disabled:!R(s),class:"border rounded px-2 py-1 w-40"},null,8,me),[[b,s.name]])]),e("td",ve,y(s.email),1),e("td",fe,[u(e("select",{"onUpdate:modelValue":n=>s.role=n,disabled:!j(s),class:"border rounded px-2 py-1"},[t[15]||(t[15]=e("option",{value:"USER"},"USER",-1)),t[16]||(t[16]=e("option",{value:"MANAGER"},"MANAGER",-1)),a(o)&&(a(o).role==="ADMIN"||a(o).role==="OWNER")?(r(),d("option",ye,"ADMIN")):m("",!0),a(o)&&a(o).role==="OWNER"?(r(),d("option",_e,"ADMIN_MANAGER")):m("",!0)],8,be),[[E,s.role]])]),e("td",Ne,[u(e("select",{"onUpdate:modelValue":n=>s.managerId=n,disabled:!$(s),class:"border rounded px-2 py-1"},[t[17]||(t[17]=e("option",{value:null},"No Manager",-1)),(r(!0),d(w,null,M(a(k),n=>(r(),d("option",{key:n.id,value:n.id},y(n.name),9,Ae))),128))],8,xe),[[E,s.managerId,void 0,{number:!0}]])]),e("td",ge,[e("button",{class:"px-3 py-1 border rounded disabled:opacity-50",disabled:!a(A)[s.id]||!R(s),onClick:n=>B(s)},"Save",8,he),e("button",{class:"ml-2 px-3 py-1 border rounded",disabled:!T(s),onClick:n=>H(s)},"Reset Password",8,Ee),a(o)&&(a(o).role==="OWNER"||a(o).role==="ADMIN")?(r(),d("button",{key:0,class:"ml-2 px-3 py-1 border rounded",onClick:n=>z(s)},"Page Access",8,we)):m("",!0)])]))),128))])])]),a(v)?(r(),d("div",Me,[e("div",Re,[e("h3",Ie,"Reset Password for "+y(a(v).name),1),u(e("input",{type:"password","onUpdate:modelValue":t[5]||(t[5]=s=>S(f)?f.value=s:null),placeholder:"New password",class:"border rounded px-2 py-1 w-full"},null,512),[[b,a(f)]]),u(e("input",{type:"password","onUpdate:modelValue":t[6]||(t[6]=s=>S(x)?x.value=s:null),placeholder:"Confirm password",class:"border rounded px-2 py-1 w-full"},null,512),[[b,a(x)]]),a(g)?(r(),d("div",ke,y(a(g)),1)):m("",!0),e("div",Ue,[e("button",{class:"px-3 py-1 border rounded",onClick:L},"Cancel"),e("button",{class:"px-3 py-1 border rounded bg-black text-white",disabled:!a(V),onClick:q},"Update",8,Ve)])])])):m("",!0),a(_)?(r(),d("div",Ce,[e("div",De,[e("h3",Pe,"Home Page Access for "+y(a(_).name),1),e("div",Oe,[(r(!0),d(w,null,M(a(h),s=>(r(),d("div",{key:s.id,class:"flex items-center justify-between border rounded px-2 py-1"},[e("div",Se,[u(e("input",{type:"checkbox","onUpdate:modelValue":n=>a(c)[s.id].enabled=n},null,8,Ge),[[W,a(c)[s.id].enabled]]),e("span",null,y(s.name),1)]),e("label",We,[u(e("input",{type:"checkbox","onUpdate:modelValue":n=>a(c)[s.id].canEdit=n,disabled:!a(c)[s.id].enabled},null,8,$e),[[W,a(c)[s.id].canEdit]]),t[19]||(t[19]=G(" Can edit layout ",-1))])]))),128))]),e("div",{class:"flex justify-end gap-2 pt-2"},[e("button",{class:"px-3 py-1 border rounded",onClick:C},"Cancel"),e("button",{class:"px-3 py-1 border rounded bg-black text-white",onClick:J},"Save")])])])):m("",!0)])}}});export{Fe as default};
