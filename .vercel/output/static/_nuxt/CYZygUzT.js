import{f as W,I as te,r as x,i as q,j as z,c as v,a as t,s as S,p as R,v as O,m as l,q as N,F as E,y as V,o as p,t as D,h as H,g as K,x as P,l as C,J as ge,B as Z,b as X}from"#entry";import{u as oe}from"./rBv2ZT4f.js";const $e={class:"space-y-4"},Ie={class:"divide-y"},_e={class:"font-medium"},ke={class:"text-gray-700 whitespace-pre-line"},we=W({__name:"MessageBoard",props:{projectId:{}},setup(M){const y=M,{id:b}=te(oe()),m=x([]),u=x(""),a=x("");async function g(){m.value=await $fetch(`/api/messages/${y.projectId}`)}q(g),z(()=>y.projectId,g);async function w(){!u.value||!a.value||(await $fetch(`/api/messages/${y.projectId}`,{method:"POST",body:{title:u.value,content:a.value,userId:b.value}}),u.value="",a.value="",await g())}return(_,$)=>(p(),v("div",$e,[t("form",{class:"space-y-2",onSubmit:S(w,["prevent"])},[R(t("input",{"onUpdate:modelValue":$[0]||($[0]=f=>N(u)?u.value=f:null),placeholder:"Title",class:"border rounded px-3 py-2 w-full"},null,512),[[O,l(u)]]),R(t("textarea",{"onUpdate:modelValue":$[1]||($[1]=f=>N(a)?a.value=f:null),placeholder:"Write a message...",class:"border rounded px-3 py-2 w-full h-24"},null,512),[[O,l(a)]]),$[2]||($[2]=t("button",{class:"bg-black text-white px-4 py-2 rounded"},"Post",-1))],32),t("ul",Ie,[(p(!0),v(E,null,V(l(m),f=>(p(),v("li",{key:f.id,class:"py-3"},[t("p",_e,D(f.title),1),t("p",ke,D(f.content),1)]))),128))])]))}}),je=Object.assign(we,{__name:"MessageBoard"}),De={class:"border rounded p-4 space-y-3"},Se={class:"flex items-center justify-between"},Ce={class:"font-medium"},Te={class:"space-y-2"},Me=["onDragstart","onDragover","onDrop"],Be={class:"flex items-center gap-2"},Ae=["checked","onChange"],Ue={class:"ml-auto inline-flex gap-1"},Pe=["onClick"],Re=["onClick"],Oe={key:0,class:"pl-6 space-y-2"},Ee=["onDrop"],Ve=["onDragstart","onDragover","onDrop"],Fe=["checked","onChange"],Le={class:"ml-auto inline-flex gap-1"},ze=["onClick"],Ne=["onClick"],He=["onSubmit"],We=["onUpdate:modelValue"],qe=["aria-label","onClick"],Je={class:"mt-2"},Ke={class:"inline-flex border rounded overflow-hidden"},Xe=W({__name:"TodoModule",props:{projectId:{},listId:{},title:{}},emits:["created","remove"],setup(M,{emit:y}){const b=M,m=y,u=H(()=>b.title??"Todo List"),a=x([]),g=x("inprogress"),w=x(""),_=x(b.listId??null),$=K({}),f=K({}),o=K({type:null}),i=x(null),c=x(null),h=x(null),I=H(()=>(Array.isArray(a.value)?a.value:[]).filter(d=>d&&(g.value==="inprogress"?!d.done:!!d.done)));q(async()=>{await J()}),z(()=>b.listId,async e=>{e&&e!==_.value&&(_.value=e,await T())}),z(()=>b.projectId,async e=>{e&&e>0&&await J()});async function T(){if(!_.value)return;const d=(await $fetch(`/api/todos/${b.projectId}`)).find(s=>s.id===_.value),n=Array.isArray(d?.items)?d.items:[];a.value=n.filter(s=>s&&typeof s.id=="number").map(s=>({id:s.id,content:String(s.content??s.title??""),done:!!s.done,subItems:Array.isArray(s.subItems)?s.subItems.filter(r=>r&&typeof r.id=="number").map(r=>({id:r.id,content:String(r.content||""),done:!!r.done,todoItemId:Number(r.todoItemId||s.id)})):[]}))}async function J(){try{if(!b.projectId||b.projectId<=0)return;if(!_.value){const e=await $fetch(`/api/todos/${b.projectId}`,{method:"POST",body:{title:u.value}});_.value=e.id,m("created",e.id)}await T()}catch(e){console.error("TodoModule init failed",e)}}async function se(){!w.value||!_.value||(await $fetch("/api/todo-items",{method:"POST",body:{todoId:_.value,content:w.value}}),w.value="",await T())}async function ne(e,d){!e||typeof e.id!="number"||(e.done=!!d,await $fetch("/api/todo-items",{method:"PUT",body:{id:e.id,done:e.done}}),await T())}function de(e){return!e||typeof e!="object"?[]:e.done?[]:Array.isArray(e.subItems)?e.subItems:[]}function ae(e){return e&&typeof e=="object"&&"done"in e&&"id"in e}const ie=e=>(de(e)||[]).filter(d=>d&&typeof d=="object");function le(e){f[e.id]=!f[e.id]}async function re(e){$[e.id]&&(await $fetch("/api/todo-subitems",{method:"POST",body:{todoItemId:e.id,content:$[e.id]}}),$[e.id]="",f[e.id]=!1,await T())}async function ce(e,d){!e||typeof e.id!="number"||(e.done=!!d,await $fetch("/api/todo-subitems",{method:"PUT",body:{id:e.id,done:e.done}}))}function Y(e,d,n){const s=e.findIndex(B=>B.id===d);if(s<0)return e;const r=s+n;if(r<0||r>=e.length)return e;const j=e.slice(),[k]=j.splice(s,1);return j.splice(r,0,k),j}async function G(e,d){a.value=Y(a.value,e.id,d);const n=a.value.map((s,r)=>({id:s.id,position:r}));await $fetch("/api/todo-items",{method:"PUT",body:{order:n}})}async function Q(e,d,n){const s=e.subItems??[];e.subItems=Y(s,d.id,n);const r=(e.subItems??[]).map((j,k)=>({id:j.id,position:k}));await $fetch("/api/todo-subitems",{method:"PUT",body:{order:r}})}function ue(e){o.type="item",o.itemId=e.id}function pe(e){i.value=e.id}async function me(e){if(o.type!=="item"||o.itemId===void 0||o.itemId===e.id)return;const d=a.value.findIndex(k=>k.id===o.itemId),n=a.value.findIndex(k=>k.id===e.id);if(d<0||n<0)return;const s=a.value.slice(),[r]=s.splice(d,1);s.splice(n,0,r),a.value=s,i.value=null,o.type=null;const j=a.value.map((k,B)=>({id:k.id,position:B}));await $fetch("/api/todo-items",{method:"PUT",body:{order:j}})}function fe(e,d,n){o.type="sub",o.parentId=e.id,o.subId=d.id;try{n?.dataTransfer?.setData("text/plain",String(d.id))}catch{}}function ve(e,d){c.value=e.id,h.value=d.id}async function ye(e,d){if(o.type!=="sub"||o.parentId!==e.id||o.subId===void 0||o.subId===d.id)return;const n=e.subItems??[],s=n.findIndex(F=>F.id===o.subId),r=n.findIndex(F=>F.id===d.id);if(s<0||r<0)return;const j=n.slice(),[k]=j.splice(s,1),B=r>s?r-1:r;j.splice(B,0,k),e.subItems=j,c.value=null,h.value=null,o.type=null;const he=(e.subItems??[]).map((F,xe)=>({id:F.id,position:xe}));await $fetch("/api/todo-subitems",{method:"PUT",body:{order:he}})}async function be(e){if(o.type!=="sub"||o.parentId!==e.id||o.subId===void 0)return;const d=e.subItems??[],n=d.findIndex(k=>k.id===o.subId);if(n<0)return;const s=d.slice(),[r]=s.splice(n,1);s.push(r),e.subItems=s,c.value=null,h.value=null,o.type=null;const j=(e.subItems??[]).map((k,B)=>({id:k.id,position:B}));await $fetch("/api/todo-subitems",{method:"PUT",body:{order:j}})}return(e,d)=>(p(),v("div",De,[t("div",Se,[t("h3",Ce,D(l(u)),1),t("button",{class:"text-sm text-red-600",onClick:d[0]||(d[0]=n=>e.$emit("remove"))},"Remove")]),t("form",{class:"flex gap-2",onSubmit:S(se,["prevent"])},[R(t("input",{"onUpdate:modelValue":d[1]||(d[1]=n=>N(w)?w.value=n:null),placeholder:"Add item",class:"border rounded px-2 py-1 flex-1"},null,512),[[O,l(w)]]),d[5]||(d[5]=t("button",{class:"bg-gray-800 text-white px-2 py-1 rounded"},"Add",-1))],32),t("ul",Te,[ae(e.it)?(p(!0),v(E,{key:0},V(l(I),n=>(p(),v("li",{key:n?.id??Math.random(),class:C(["space-y-1",{"bg-gray-50 rounded":l(i)===n.id}]),draggable:"true",onDragstart:s=>ue(n),onDragover:S(s=>pe(n),["prevent"]),onDrop:S(s=>me(n),["prevent"])},[t("div",Be,[t("input",{type:"checkbox",checked:!!n?.done,onChange:s=>ne(n,s?.target?.checked)},null,40,Ae),t("span",{class:C({"line-through text-gray-500":!!n?.done})},D(n?.content??""),3),t("div",Ue,[t("button",{class:"px-2 py-0.5 border rounded text-xs",onClick:s=>G(n,-1)},"↑",8,Pe),t("button",{class:"px-2 py-0.5 border rounded text-xs",onClick:s=>G(n,1)},"↓",8,Re)])]),Array.isArray(n.subItems)?(p(),v("div",Oe,[Array.isArray(n.subItems)?(p(),v("ul",{key:0,class:"space-y-1",onDragover:d[2]||(d[2]=S(()=>{},["prevent"])),onDrop:S(s=>be(n),["prevent"])},[(p(!0),v(E,null,V(ie(n),s=>(p(),v("li",{key:s?.id??Math.random(),class:C(["flex items-center gap-2",{"bg-gray-50 rounded":l(h)===s.id&&l(c)===n.id}]),draggable:"true",onDragstart:r=>fe(n,s,r),onDragover:S(r=>ve(n,s),["prevent"]),onDrop:S(r=>ye(n,s),["prevent"])},[t("input",{type:"checkbox",checked:!!s?.done,onChange:r=>ce(s,r?.target?.checked)},null,40,Fe),t("span",{class:C({"line-through text-gray-400":!!s?.done})},D(s?.content??""),3),t("div",Le,[t("button",{class:"px-2 py-0.5 border rounded text-xs",onClick:r=>Q(n,s,-1)},"↑",8,ze),t("button",{class:"px-2 py-0.5 border rounded text-xs",onClick:r=>Q(n,s,1)},"↓",8,Ne)])],42,Ve))),128))],40,Ee)):P("",!0),l(f)[n.id]&&!n.done?(p(),v("form",{key:1,class:"flex gap-2",onSubmit:S(s=>re(n),["prevent"])},[R(t("input",{"onUpdate:modelValue":s=>l($)[n.id]=s,placeholder:"Add subtask",class:"border rounded px-2 py-1 flex-1"},null,8,We),[[O,l($)[n.id]]]),d[6]||(d[6]=t("button",{class:"border px-2 py-1 rounded"},"Add",-1))],40,He)):P("",!0),n.done?P("",!0):(p(),v("button",{key:2,type:"button",class:"w-8 h-8 rounded-full border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200 flex items-center justify-center","aria-label":l(f)[n.id]?"Hide subtask input":"Add subtask",onClick:s=>le(n)},[...d[7]||(d[7]=[t("span",{class:"text-lg leading-none"},"+",-1)])],8,qe))])):P("",!0)],42,Me))),128)):P("",!0)]),t("div",Je,[t("div",Ke,[t("button",{class:C(["px-2 py-1 text-xs",l(g)==="inprogress"?"bg-black text-white":""]),onClick:d[3]||(d[3]=n=>g.value="inprogress")},"In Progress",2),t("button",{class:C(["px-2 py-1 text-xs",l(g)==="completed"?"bg-black text-white":""]),onClick:d[4]||(d[4]=n=>g.value="completed")},"Completed",2)])])]))}}),Ye={class:"border rounded p-4 space-y-3"},Ge={class:"flex items-center justify-between"},Qe={class:"w-full overflow-x-auto"},Ze=["viewBox"],et=["x2"],tt=["transform","onClick"],ot=["y2"],st=["cy"],nt=["y"],dt=["y"],L=800,at=140,U=32,A=100,it=W({__name:"RoadmapModule",props:{projectId:{}},setup(M){const y=M,{id:b}=te(oe()),m=x([]),u=x(""),a=x("");async function g(){m.value=await $fetch(`/api/roadmap/${y.projectId}`)}q(g),z(()=>y.projectId,g);async function w(){!u.value||!a.value||(await $fetch(`/api/roadmap/${y.projectId}`,{method:"POST",body:{description:u.value,date:a.value,userId:b.value}}),u.value="",a.value="",await g())}async function _(c){await $fetch(`/api/roadmap/${y.projectId}?id=${c}`,{method:"DELETE"}),await g()}function $(c){return new Date(c).toLocaleDateString(void 0,{month:"short",day:"numeric"})}const f=H(()=>m.value.length===0?null:new Date(Math.min(...m.value.map(c=>new Date(c.date).getTime())))),o=H(()=>m.value.length===0?null:new Date(Math.max(...m.value.map(c=>new Date(c.date).getTime()))));function i(c){const h=new Date(c);if(!f.value||!o.value)return L/2;const I=f.value.getTime(),T=o.value.getTime();if(T===I)return(L-2*U)/2+U;const J=(h.getTime()-I)/(T-I);return U+J*(L-2*U)}return(c,h)=>(p(),v("div",Ye,[t("div",Ge,[h[3]||(h[3]=t("h3",{class:"font-medium"},"Road Map",-1)),t("button",{class:"text-sm text-red-600",onClick:h[0]||(h[0]=I=>c.$emit("remove"))},"Remove")]),t("form",{class:"flex flex-col md:flex-row gap-2",onSubmit:S(w,["prevent"])},[R(t("input",{"onUpdate:modelValue":h[1]||(h[1]=I=>N(u)?u.value=I:null),placeholder:"Short description",class:"border rounded px-2 py-1 flex-1"},null,512),[[O,l(u)]]),R(t("input",{"onUpdate:modelValue":h[2]||(h[2]=I=>N(a)?a.value=I:null),type:"date",class:"border rounded px-2 py-1"},null,512),[[O,l(a)]]),h[4]||(h[4]=t("button",{class:"bg-gray-800 text-white px-2 py-1 rounded"},"Add",-1))],32),t("div",Qe,[(p(),v("svg",{viewBox:`0 0 ${L} ${at}`,class:"w-full min-w-[600px]",preserveAspectRatio:"xMidYMid meet"},[t("line",{x1:U,x2:L-U,y1:A,y2:A,stroke:"#111827","stroke-width":"2"},null,8,et),(p(!0),v(E,null,V(l(m),I=>(p(),v("g",{key:I.id,transform:`translate(${i(I.date)},0)`,class:"cursor-pointer",onClick:T=>_(I.id)},[t("line",{x1:0,x2:0,y1:A,y2:A-32,stroke:"#6b7280","stroke-width":"2"},null,8,ot),t("circle",{cx:0,cy:A-34,r:"5",fill:"#111827"},null,8,st),t("text",{x:0,y:A-44,"text-anchor":"middle",class:"fill-gray-800",style:{"font-size":"10px"}},D($(I.date)),9,nt),t("text",{x:0,y:A-58,"text-anchor":"middle",class:"fill-gray-700",style:{"font-size":"11px"}},D(I.description),9,dt)],8,tt))),128))],8,Ze))])]))}}),lt={class:"border rounded p-4 space-y-3"},rt={class:"flex items-center justify-between"},ct={class:"font-medium"},ut=["disabled"],pt=["disabled"],mt={class:"space-y-1"},ft=["href"],vt={key:0,class:"text-gray-400 text-xs"},yt=["onClick"],ee=W({__name:"AttachmentsModule",props:{projectId:{},title:{},scope:{}},emits:["remove"],setup(M){const y=M,b=H(()=>y.title??(y.scope==="private"?"My Attachments":"Shared Attachments")),m=x(!1),u=x(null),a=x([]);q(g),z(()=>y.projectId,()=>g());async function g(){if(!y.projectId)return;const o=y.scope||"shared";a.value=await $fetch(`/api/files/${y.projectId}?scope=${o}`)}async function w(){if(!u.value||!u.value.files||u.value.files.length===0)return;const o=u.value.files[0],i=new FormData;i.append("file",o),m.value=!0;try{const c=y.scope||"shared",h=await $fetch(`/api/files/${y.projectId}?scope=${c}`,{method:"POST",body:i});a.value.unshift(h),u.value&&(u.value.value="")}finally{m.value=!1}}function _(o){try{return o.split("/").filter(Boolean).pop()||o}catch{return o}}function $(o){const i=o?.metadata?.size;return!i||typeof i!="number"?"":i<1024?`${i} B`:i<1024*1024?`${Math.round(i/1024)} KB`:`${(i/1024/1024).toFixed(1)} MB`}async function f(o){await $fetch(`/api/files/${y.projectId}?id=${o.id}`,{method:"DELETE"}),a.value=a.value.filter(i=>i.id!==o.id)}return(o,i)=>(p(),v("div",lt,[t("div",rt,[t("h3",ct,D(l(b)),1),t("button",{class:"text-sm text-red-600",onClick:i[0]||(i[0]=c=>o.$emit("remove"))},"Remove")]),t("form",{class:"flex items-center gap-2",onSubmit:S(w,["prevent"])},[t("input",{ref_key:"fileInput",ref:u,type:"file",disabled:l(m)},null,8,ut),t("button",{class:"bg-gray-800 text-white px-3 py-1 rounded disabled:opacity-50",disabled:l(m)},D(l(m)?"Uploading...":"Upload"),9,pt)],32),t("ul",mt,[(p(!0),v(E,null,V(l(a),c=>(p(),v("li",{key:c.id,class:"flex items-center gap-2"},[t("a",{class:"text-blue-600 underline",href:c.path,target:"_blank"},D(_(c.path)),9,ft),$(c)?(p(),v("span",vt,"("+D($(c))+")",1)):P("",!0),t("button",{class:"text-red-600 text-sm ml-auto",onClick:h=>f(c)},"Delete",8,yt)]))),128))])]))}}),bt={class:"p-6"},ht={class:"flex items-center justify-between"},xt={class:"text-2xl font-semibold"},gt={class:"text-gray-500"},$t={class:"flex gap-2"},It={class:"mt-6"},_t={key:1,class:"space-y-4"},kt={class:"grid md:grid-cols-2 gap-6"},wt={key:2,class:"space-y-4"},jt={key:3,class:"space-y-4"},Dt={class:"grid md:grid-cols-2 gap-6"},Tt=W({__name:"[slug]",setup(M){const y=ge(),b=x("messages"),m=x(null),u=x([]);x("");function a(f){return["px-3 py-2 rounded border",b.value===f?"bg-black text-white":"bg-white"]}async function g(){m.value=await $fetch(`/api/projects/${y.params.slug}`)}q(g);function w(){u.value.push({key:Math.random().toString(36).slice(2),listId:null,title:"Todo List"})}function _(f){u.value=u.value.filter(o=>o.key!==f)}function $(f,o){const i=u.value.find(c=>c.key===f);i&&(i.listId=o)}return(f,o)=>(p(),v("div",bt,[t("div",ht,[t("div",null,[t("h1",xt,D(l(m)?.name),1),t("p",gt,"/"+D(l(y).params.slug),1)]),t("div",$t,[t("button",{onClick:o[0]||(o[0]=i=>b.value="messages"),class:C(a("messages"))},"Messages",2),t("button",{onClick:o[1]||(o[1]=i=>b.value="todos"),class:C(a("todos"))},"Todos",2),t("button",{onClick:o[2]||(o[2]=i=>b.value="roadmap"),class:C(a("roadmap"))},"Road Map",2),t("button",{onClick:o[3]||(o[3]=i=>b.value="files"),class:C(a("files"))},"Files",2)])]),t("div",It,[l(b)==="messages"?(p(),Z(je,{key:0,"project-id":l(m)?.id||0},null,8,["project-id"])):l(b)==="todos"?(p(),v("div",_t,[t("div",{class:"flex justify-between items-center"},[o[4]||(o[4]=t("h2",{class:"text-xl font-semibold"},"Todo Modules",-1)),t("button",{class:"bg-black text-white px-3 py-2 rounded",onClick:w},"Add module")]),t("div",kt,[(p(!0),v(E,null,V(l(u),i=>(p(),Z(Xe,{key:i.key,"project-id":l(m)?.id||0,"list-id":i.listId,title:i.title,onCreated:c=>$(i.key,c),onRemove:c=>_(i.key)},null,8,["project-id","list-id","title","onCreated","onRemove"]))),128))])])):l(b)==="roadmap"?(p(),v("div",wt,[o[5]||(o[5]=t("h2",{class:"text-xl font-semibold"},"Road Map",-1)),X(it,{"project-id":l(m)?.id||0},null,8,["project-id"])])):(p(),v("div",jt,[o[6]||(o[6]=t("h2",{class:"text-xl font-semibold"},"Files",-1)),t("div",Dt,[X(ee,{"project-id":l(m)?.id||0,scope:"shared"},null,8,["project-id"]),X(ee,{"project-id":l(m)?.id||0,scope:"private"},null,8,["project-id"])])]))])]))}});export{Tt as default};
