import{f as w,r as i,i as R,c,a as t,b as S,w as k,p,z as A,m as u,q as v,v as x,F as C,y as N,_ as U,o as m,d as h,t as d}from"#entry";const L={class:"p-6 space-y-4"},D={class:"flex items-center justify-between"},T={class:"flex items-end gap-3"},V={class:"overflow-x-auto"},O={class:"min-w-full text-sm"},F={class:"py-2 pr-4"},B={class:"py-2 pr-4"},H={class:"py-2 pr-4"},I={class:"py-2 pr-4"},M={class:"py-2 pr-4"},P={class:"whitespace-pre-wrap"},G=w({__name:"audit-logs",setup(W){const y=i([]),a=i(""),l=i(""),n=i("");function _(o){return new Date(o).toLocaleString()}function g(o){try{return JSON.stringify(o,null,2)}catch{return String(o)}}async function f(){y.value=await $fetch("/api/audit-logs",{query:{action:a.value||void 0,start:l.value||void 0,end:n.value||void 0}})}R(f);async function E(){const o=new URLSearchParams;a.value&&o.set("action",a.value),l.value&&o.set("start",l.value),n.value&&o.set("end",n.value),o.set("format","csv");const e=`/api/audit-logs?${o.toString()}`,s=await(await fetch(e)).blob(),r=document.createElement("a");r.href=URL.createObjectURL(s),r.download="audit-logs.csv",document.body.appendChild(r),r.click(),r.remove()}return(o,e)=>{const b=U;return m(),c("div",L,[t("div",D,[e[4]||(e[4]=t("h1",{class:"text-2xl font-semibold"},"Audit Logs",-1)),S(b,{to:"/",class:"underline"},{default:k(()=>[...e[3]||(e[3]=[h("Back",-1)])]),_:1})]),t("div",T,[t("div",null,[e[6]||(e[6]=t("label",{class:"block text-sm text-gray-600"},"Action",-1)),p(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>v(a)?a.value=s:null),class:"border rounded px-2 py-1"},[...e[5]||(e[5]=[t("option",{value:""},"All",-1),t("option",{value:"USER_CREATE"},"USER_CREATE",-1),t("option",{value:"ROLE_CHANGE"},"ROLE_CHANGE",-1),t("option",{value:"OWNERSHIP_TRANSFER"},"OWNERSHIP_TRANSFER",-1)])],512),[[A,u(a)]])]),t("div",null,[e[7]||(e[7]=t("label",{class:"block text-sm text-gray-600"},"Start",-1)),p(t("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=s=>v(l)?l.value=s:null),class:"border rounded px-2 py-1"},null,512),[[x,u(l)]])]),t("div",null,[e[8]||(e[8]=t("label",{class:"block text-sm text-gray-600"},"End",-1)),p(t("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=s=>v(n)?n.value=s:null),class:"border rounded px-2 py-1"},null,512),[[x,u(n)]])]),t("button",{class:"px-3 py-2 border rounded",onClick:f},"Filter"),t("button",{class:"px-3 py-2 border rounded",onClick:E},"Download CSV")]),t("div",V,[t("table",O,[e[9]||(e[9]=t("thead",null,[t("tr",{class:"text-left border-b"},[t("th",{class:"py-2 pr-4"},"When"),t("th",{class:"py-2 pr-4"},"Action"),t("th",{class:"py-2 pr-4"},"Actor"),t("th",{class:"py-2 pr-4"},"Target"),t("th",{class:"py-2 pr-4"},"Details")])],-1)),t("tbody",null,[(m(!0),c(C,null,N(u(y),s=>(m(),c("tr",{key:s.id,class:"border-b"},[t("td",F,d(_(s.createdAt)),1),t("td",B,d(s.action),1),t("td",H,d(s.actor?.name||s.actorUserId),1),t("td",I,d(s.target?.name||s.targetUserId||"-"),1),t("td",M,[t("pre",P,d(g(s.details)),1)])]))),128))])])])])}}});export{G as default};
