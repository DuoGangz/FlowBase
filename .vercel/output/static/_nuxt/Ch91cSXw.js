import{e as We,r as m,f as ke,g as K,h as q,i as xe,j as ue,k as ye,c as k,o as y,n as fe,l as ne,m as t,a as e,p as re,v as ge,q as ce,s as ie,x as oe,F as de,y as pe,t as Z,d as De,z as Le,A as Oe,B as Ie,C as Ee,D as Te}from"#entry";import{u as ze}from"./rBv2ZT4f.js";const v={colWidth:540,rowHeight:360,gutterX:16,gutterY:16,COLS:3,ROWS:3,get stepX(){return this.colWidth+this.gutterX},get stepY(){return this.rowHeight+this.gutterY}},_e=We("snapGrid",()=>{const le=m({}),l=m({}),x=m(3),J=m(0);function D(a){const d=a??window.innerWidth;x.value=Math.max(1,Math.floor((d+v.gutterX)/v.stepX))||3}function h(a,d){return`${a},${d}`}function Y(a){const d=l.value[a];d&&(delete l.value[a],delete le.value[h(d.col,d.row)])}function C(a,d,L){const s=h(a,d),M=le.value[s];return!M||M===L}function W(a,d,L){Y(a);const s=h(d,L);le.value[s]=a,l.value[a]={col:d,row:L}}function G(a){let{col:d,row:L}=a;return d++,d>=v.COLS&&(d=0,L++),{col:d,row:L}}function I(a,d){if(console.log(`[SNAP] ${a} requesting cell (${d.col}, ${d.row})`),D(),C(d.col,d.row,a))return console.log(`[SNAP] Cell (${d.col}, ${d.row}) is free, placing ${a}`),W(a,d.col,d.row),{...l.value[a]};const L=le.value[h(d.col,d.row)];if(console.log(`[SNAP] Cell (${d.col}, ${d.row}) occupied by: ${L}`),!L)return console.log(`[SNAP] No victim found, placing ${a}`),W(a,d.col,d.row),{...l.value[a]};let s=G(d);for(;!C(s.col,s.row,L);)if(s=G(s),s.row>1e3)return console.log(`[SNAP] No space found for ${L}, keeping original position`),{...l.value[a]};console.log(`[SNAP] Moving ${L} from (${d.col}, ${d.row}) to (${s.col}, ${s.row})`),W(L,s.col,s.row),console.log(`[SNAP] Placing ${a} at (${d.col}, ${d.row})`),W(a,d.col,d.row);const M={...l.value[a]};return console.log(`[SNAP] Final result for ${a}:`,M),M}function T(a,d){const L=Math.max(0,Math.round(a/v.stepX)),s=Math.max(0,Math.round(d/v.stepY));return{col:L,row:s}}function O(a,d){return{x:a*v.stepX,y:d*v.stepY}}function p(a){a==="small"?(v.colWidth=450,v.rowHeight=300):a==="medium"?(v.colWidth=540,v.rowHeight=360):(v.colWidth=660,v.rowHeight=440);const d={};for(const L in l.value){const s=l.value[L];s&&(d[L]={...s})}l.value=d,J.value++}return{cellToId:le,cells:l,maxCols:x,version:J,updateMaxCols:D,key:h,release:Y,isFree:C,placeAt:W,nextCell:G,requestSnap:I,colRowFromPx:T,pxFromColRow:O,setSizePreset:p}}),He={class:"flex items-center justify-between"},Re={class:"space-y-2"},Ae=["onDragstart","onDragover","onDrop"],Pe={class:"flex items-center gap-2"},Fe=["checked","onChange"],Ue={class:"ml-auto inline-flex gap-1"},je=["onClick"],Ne=["onClick"],Be={class:"pl-6 space-y-2"},Ve={class:"space-y-1"},Ge=["onMousedown"],qe=["checked","onChange"],Ke={class:"ml-auto inline-flex gap-1"},Je=["onClick"],Qe=["onClick"],Ze=["onSubmit"],et=["onUpdate:modelValue"],tt=["aria-label","onClick"],nt={class:"mt-2"},ot={class:"inline-flex border rounded overflow-hidden"},Xe=200,st=ke({__name:"TodoModuleLocal",props:{snap:{type:Boolean},uid:{}},setup(le){const l=le,x=_e();function J(){if(console.log(`[TODO] applySnap called for ${l.uid}, snap=${l.snap}`),!l.snap)return;M.w=v.colWidth,M.h=v.rowHeight;const o=x.colRowFromPx(s.x,s.y);console.log(`[TODO] Current position: (${s.x}, ${s.y}) -> desired cell: (${o.col}, ${o.row})`);const u=x.requestSnap(l.uid,o),_=x.pxFromColRow(u.col,u.row);console.log(`[TODO] Final position: (${_.x}, ${_.y})`),s.x=_.x,s.y=_.y}const D=m("Todo List"),h=m([]),Y=m("inprogress"),C=m(""),W=m(!0),G=K({}),I=K({}),T=m(null);m(null),m(null);const O=K({type:null}),p=K({active:!1,parentIdx:null,currentIdx:null,overIdx:null}),a=new Map;function d(o,u){return`${o}:${u}`}function L(o,u,_){if(!_){a.delete(d(o,u));return}a.set(d(o,u),_)}const s=K({x:0,y:0}),M=K({w:v.colWidth,h:v.rowHeight}),z=K({dragging:!1,startX:0,startY:0,originX:0,originY:0}),U=K({resizing:!1,startX:0,startY:0,originW:0,originH:0}),A=q(()=>({width:M.w+"px",height:M.h+"px",transform:`translate(${s.x}px, ${s.y}px)`,position:l.snap?"absolute":"relative",top:l.snap?"0px":"auto",left:l.snap?"0px":"auto",boxSizing:"border-box"})),se=q(()=>["border rounded-2xl p-2 space-y-2 shadow bg-white overflow-hidden",z.dragging?"select-none cursor-grabbing z-50":"select-text cursor-default"]);function te(o){if(z.dragging){const u=z.originX+(o.clientX-z.startX),_=z.originY+(o.clientY-z.startY);console.log(`[TODO] onMouseMove: dragging, updating position from (${s.x}, ${s.y}) to (${u}, ${_})`),s.x=u,s.y=_}else if(U.resizing){const u=Math.max(260,U.originW+(o.clientX-U.startX)),_=Math.max(200,U.originH+(o.clientY-U.startY));M.w=u,M.h=_}}function ee(){console.log(`[TODO] onMouseUp called, snap=${l.snap}`),z.dragging=!1,U.resizing=!1,W.value=!0,c.value!==null&&(clearTimeout(c.value),c.value=null),l.snap&&(console.log("[TODO] Calling applySnap from onMouseUp"),J())}function P(o){U.resizing=!0,U.startX=o.clientX,U.startY=o.clientY,U.originW=M.w,U.originH=M.h}const c=m(null);function Q(o){console.log("[TODO] onWrapperMouseDown called"),o.button===0&&(z.startX=o.clientX,z.startY=o.clientY,z.originX=s.x,z.originY=s.y,c.value=window.setTimeout(()=>{console.log(`[TODO] Starting drag after ${Xe}ms`),z.dragging=!0,W.value=!1},Xe))}function E(){c.value!==null&&(clearTimeout(c.value),c.value=null)}function B(){return`todoLocal:${l.uid}`}function g(){try{const o=JSON.stringify({title:D.value,items:h.value,view:Y.value});localStorage.setItem(B(),o)}catch{}}function S(){try{const o=localStorage.getItem(B());if(!o)return;const u=JSON.parse(o);typeof u?.title=="string"&&(D.value=u.title),Array.isArray(u?.items)&&(h.value=u.items),(u?.view==="completed"||u?.view==="inprogress")&&(Y.value=u.view)}catch{}}xe(()=>{window.addEventListener("mousemove",te),window.addEventListener("mouseup",ee),l.snap&&J(),S()}),ue(()=>l.snap,()=>J()),ue(()=>x.cells[l.uid],o=>{if(!l.snap||!o||z.dragging||U.resizing)return;M.w=v.colWidth,M.h=v.rowHeight;const u=x.pxFromColRow(o.col,o.row);s.x=u.x,s.y=u.y}),ue(()=>x.version,()=>{if(!l.snap)return;M.w=v.colWidth,M.h=v.rowHeight;const o=x.cells[l.uid];if(o){const u=x.pxFromColRow(o.col,o.row);s.x=u.x,s.y=u.y}}),ye(()=>{window.removeEventListener("mousemove",te),window.removeEventListener("mouseup",ee),x.release(l.uid)});function V(){C.value&&(h.value.push({id:Date.now(),content:C.value,done:!1,subItems:[]}),C.value="",g())}function X(o){return o.done?[]:o.subItems??[]}function j(o,u){const _=h.value[o];_&&(_.done=!!u,g())}function $(o){const u=G[o];if(!u)return;const _=h.value[o];_.subItems||(_.subItems=[]),_.subItems.push({id:Date.now()+Math.floor(Math.random()*1e3),content:u,done:!1}),G[o]="",I[o]=!1,g()}function N(o,u,_){const f=h.value[o]?.subItems?.[u];f&&(f.done=!!_,g())}function ve(o){I[o]=!I[o]}function he(o,u){const _=o+u;if(_<0||_>=h.value.length)return;const F=h.value.slice(),[f]=F.splice(o,1);F.splice(_,0,f),h.value=F,g()}function me(o,u,_){const F=h.value[o];F.subItems||(F.subItems=[]);const f=u+_;if(f<0||f>=F.subItems.length)return;const r=F.subItems.slice(),[w]=r.splice(u,1);r.splice(f,0,w),F.subItems=r,g()}function be(o,u){O.type="item",O.itemIdx=o,E();try{u.dataTransfer?.setData("text/plain",String(o))}catch{}}function $e(o){T.value=o}function H(o){if(O.type!=="item"||O.itemIdx===void 0||O.itemIdx===o)return;const u=h.value.slice(),[_]=u.splice(O.itemIdx,1);u.splice(o,0,_),h.value=u,T.value=null,O.type=null,g()}function R(o,u,_){E(),p.active=!0,p.parentIdx=o,p.currentIdx=u,p.overIdx=u,_.preventDefault(),window.addEventListener("mousemove",n),window.addEventListener("mouseup",i)}function n(o){if(!p.active||p.parentIdx===null||p.currentIdx===null)return;const u=h.value[p.parentIdx],_=u.subItems??[];let F=0,f=1/0;for(let r=0;r<_.length;r++){const w=a.get(d(p.parentIdx,r));if(!w)continue;const ae=w.getBoundingClientRect(),we=ae.top+ae.height/2,Ye=Math.abs(o.clientY-we);Ye<f&&(f=Ye,F=r)}if(F!==p.currentIdx){const r=(u.subItems??[]).slice(),[w]=r.splice(p.currentIdx,1);r.splice(F,0,w),u.subItems=r,p.currentIdx=F,p.overIdx=F}else p.overIdx=F}function i(){b()}function b(){p.active=!1,p.parentIdx=null,p.currentIdx=null,p.overIdx=null,window.removeEventListener("mousemove",n),window.removeEventListener("mouseup",i),g()}return(o,u)=>(y(),k("div",{class:ne(t(se)),style:fe(t(A)),onMousedown:Q},[e("div",He,[re(e("input",{"onUpdate:modelValue":u[0]||(u[0]=_=>ce(D)?D.value=_:null),class:"font-medium w-full mr-2 border-b rounded-md px-2 py-1"},null,512),[[ge,t(D)]]),e("button",{class:"text-sm text-red-600",onClick:u[1]||(u[1]=_=>o.$emit("remove"))},"Remove")]),e("form",{class:"flex gap-2",onSubmit:ie(V,["prevent"])},[re(e("input",{"onUpdate:modelValue":u[2]||(u[2]=_=>ce(C)?C.value=_:null),placeholder:"Add item",class:"border rounded-md px-2 py-1 flex-1"},null,512),[[ge,t(C)]]),u[6]||(u[6]=e("button",{class:"bg-gray-800 text-white px-2 py-1 rounded-md"},"Add",-1))],32),e("ul",Re,[(t(Y)==="inprogress"?!o.it?.done:o.it?.done)?(y(!0),k(de,{key:0},pe(t(h),(_,F)=>(y(),k("li",{key:_?.id??F,class:ne(["space-y-1",{"bg-gray-50 rounded":t(T)===F}]),draggable:"true",onDragstart:f=>be(F,f),onDragover:ie(f=>$e(F),["prevent"]),onDrop:ie(f=>H(F),["prevent"]),onMousedown:u[3]||(u[3]=ie(()=>{},["stop"]))},[e("div",Pe,[e("input",{type:"checkbox",checked:!!_?.done,onChange:f=>j(F,f?.target?.checked)},null,40,Fe),e("span",{class:ne({"line-through text-gray-500":!!_?.done})},Z(_?.content??""),3),e("div",Ue,[e("button",{class:"px-2 py-0.5 border rounded text-xs",onClick:f=>he(F,-1)},"↑",8,je),e("button",{class:"px-2 py-0.5 border rounded text-xs",onClick:f=>he(F,1)},"↓",8,Ne)])]),e("div",Be,[e("ul",Ve,[(y(!0),k(de,null,pe(X(_),(f,r)=>(y(),k("li",{key:f?.id??r,class:ne(["flex items-center gap-2 cursor-move",{"bg-gray-50 rounded":t(p).active&&t(p).parentIdx===F&&t(p).overIdx===r}]),onMousedown:ie(w=>R(F,r,w),["stop"]),ref_for:!0,ref:w=>L(F,r,w)},[e("input",{type:"checkbox",checked:!!f?.done,onChange:w=>N(F,r,w?.target?.checked)},null,40,qe),e("span",{class:ne({"line-through text-gray-400":!!f?.done})},Z(f?.content??""),3),e("div",Ke,[e("button",{class:"px-2 py-0.5 border rounded text-xs",onClick:w=>me(F,r,-1)},"↑",8,Je),e("button",{class:"px-2 py-0.5 border rounded text-xs",onClick:w=>me(F,r,1)},"↓",8,Qe)])],42,Ge))),128))]),t(I)[F]&&!_.done?(y(),k("form",{key:0,class:"flex gap-2",onSubmit:ie(f=>$(F),["prevent"])},[re(e("input",{"onUpdate:modelValue":f=>t(G)[F]=f,placeholder:"Add subtask",class:"border rounded-md px-2 py-1 flex-1"},null,8,et),[[ge,t(G)[F]]]),u[7]||(u[7]=e("button",{class:"border px-2 py-1 rounded-md"},"Add",-1))],40,Ze)):oe("",!0),_.done?oe("",!0):(y(),k("button",{key:1,type:"button",class:"w-8 h-8 rounded-full border border-gray-300 bg-gray-100 text-gray-700 hover:bg-gray-200 flex items-center justify-center","aria-label":t(I)[F]?"Hide subtask input":"Add subtask",onClick:f=>ve(F)},[...u[8]||(u[8]=[e("span",{class:"text-lg leading-none"},"+",-1)])],8,tt))])],42,Ae))),128)):oe("",!0)]),e("div",nt,[e("div",ot,[e("button",{class:ne(["px-2 py-1 text-xs",t(Y)==="inprogress"?"bg-black text-white":""]),onClick:u[4]||(u[4]=_=>(Y.value="inprogress",g()))},"In Progress",2),e("button",{class:ne(["px-2 py-1 text-xs",t(Y)==="completed"?"bg-black text-white":""]),onClick:u[5]||(u[5]=_=>(Y.value="completed",g()))},"Completed",2)])]),e("div",{class:"absolute right-1 bottom-1 w-4 h-4 cursor-se-resize",style:{"border-right":"2px solid #9ca3af","border-bottom":"2px solid #9ca3af"},onMousedown:ie(P,["stop"])},null,32)],38))}}),lt=Object.assign(st,{__name:"TodoModuleLocal"}),at={class:"flex items-center justify-between"},it={class:"flex items-center justify-between"},rt={class:"flex items-center gap-2"},ut={class:"font-medium"},ct={class:"flex items-center gap-1"},dt={key:0,class:"grid grid-cols-7 gap-1 text-center select-none"},pt=["onClick"],gt={class:"w-full flex items-center justify-between"},mt={class:"font-medium"},vt={key:0,class:"w-5 h-5 rounded-full bg-blue-600 text-white text-[10px] flex items-center justify-center"},ft={key:1,class:"space-y-2 select-none"},xt={class:"text-sm text-gray-600"},ht={class:"border rounded-md overflow-hidden"},wt={key:0,class:"bg-yellow-50 border-b px-3 py-2"},yt={class:"mt-1 space-y-1"},bt={class:"max-h-72 overflow-y-auto"},$t={class:"flex items-start"},kt={class:"w-16 shrink-0 text-right pr-2 pt-2 text-xs text-gray-500"},Mt={class:"flex-1 py-2"},_t={key:0,class:"space-y-1"},Ct={class:"inline-block w-14 text-gray-600"},St=200,Dt=ke({__name:"CalendarModuleLocal",props:{snap:{type:Boolean},uid:{}},setup(le){const l=le,x=_e();function J(){if(!l.snap)return;T.w=v.colWidth,T.h=v.rowHeight;const n=x.colRowFromPx(I.x,I.y),i=x.requestSnap(l.uid,n),b=x.pxFromColRow(i.col,i.row);I.x=b.x,I.y=b.y}Math.random().toString(36).slice(2);const D=m("Calendar"),h=m([]);function Y(n){const i=n.getFullYear(),b=String(n.getMonth()+1).padStart(2,"0"),o=String(n.getDate()).padStart(2,"0");return`${i}-${b}-${o}`}function C(n){const i=Y(n);return h.value.filter(b=>Y(b.at)===i)}async function W(){try{const n=await $fetch("/api/assignments?view=me");h.value=n.filter(i=>!!i.dueDate&&!i.completed).map(i=>({id:i.id,title:i.title,at:new Date(i.dueDate)}))}catch{}}const G=m(!0),I=K({x:0,y:0}),T=K({w:v.colWidth,h:v.rowHeight}),O=K({dragging:!1,startX:0,startY:0,originX:0,originY:0}),p=K({resizing:!1,startX:0,startY:0,originW:0,originH:0}),a=q(()=>({width:T.w+"px",height:T.h+"px",transform:`translate(${I.x}px, ${I.y}px)`,position:l.snap?"absolute":"relative",top:l.snap?"0px":"auto",left:l.snap?"0px":"auto",boxSizing:"border-box"})),d=q(()=>["border rounded-2xl p-2 space-y-2 shadow bg-white overflow-hidden",O.dragging?"select-none cursor-grabbing z-50":"select-text cursor-default"]),L=["Su","Mo","Tu","We","Th","Fr","Sa"],s=m(new Date),M=m(new Date),z=m("month"),U=q(()=>s.value.toLocaleString(void 0,{month:"long",year:"numeric"}));function A(n){const i=new Date(n);return i.setHours(0,0,0,0),i.setDate(i.getDate()-i.getDay()),i}function se(n){const i=A(n);return i.setDate(i.getDate()+6),i}const te=q(()=>{if(z.value==="month")return U.value;if(z.value==="week"){const n=A(s.value),i=se(s.value),b=n.toLocaleDateString(void 0,{month:"short",day:"numeric"}),o=i.toLocaleDateString(void 0,{month:"short",day:"numeric",year:(n.getFullYear()===i.getFullYear(),"numeric")});return`${b} – ${o}`}return M.value.toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric",year:"numeric"})}),ee=q(()=>M.value.toLocaleDateString(void 0,{weekday:"long",month:"long",day:"numeric",year:"numeric"})),P=q(()=>{const n=new Date(s.value.getFullYear(),s.value.getMonth(),1),i=new Date(n);i.setDate(n.getDate()-n.getDay());const b=[];for(let o=0;o<42;o++){const u=new Date(i);u.setDate(i.getDate()+o),b.push({date:u,inMonth:u.getMonth()===s.value.getMonth(),key:u.toISOString()})}return b}),c=q(()=>{const n=A(s.value),i=[];for(let b=0;b<7;b++){const o=new Date(n);o.setDate(n.getDate()+b),i.push({date:o,inMonth:o.getMonth()===s.value.getMonth(),key:o.toISOString()})}return i}),Q=q(()=>z.value==="week"?c.value:P.value);function E(n,i){return n.getFullYear()===i.getFullYear()&&n.getMonth()===i.getMonth()&&n.getDate()===i.getDate()}function B(n){M.value=new Date(n)}function g(n){z.value=n,n==="day"?M.value=new Date(s.value):n==="week"&&(s.value=new Date(M.value))}function S(n){return["px-2 py-1 border rounded-md",z.value===n?"bg-black text-white":"bg-white"]}function V(){if(z.value==="month")s.value=new Date(s.value.getFullYear(),s.value.getMonth()-1,1);else if(z.value==="week"){const n=new Date(s.value);n.setDate(n.getDate()-7),s.value=n}else{const n=new Date(M.value);n.setDate(n.getDate()-1),M.value=n,s.value=n}}function X(){if(z.value==="month")s.value=new Date(s.value.getFullYear(),s.value.getMonth()+1,1);else if(z.value==="week"){const n=new Date(s.value);n.setDate(n.getDate()+7),s.value=n}else{const n=new Date(M.value);n.setDate(n.getDate()+1),M.value=n,s.value=n}}const j=n=>[...C(n)].sort((i,b)=>i.at.getTime()-b.at.getTime());function $(n){try{return n.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit",hour12:!0})}catch{return""}}const N=q(()=>{const n=[];for(let i=0;i<24;i++)for(let b=0;b<60;b+=15){const o=new Date;o.setHours(i,b,0,0),n.push({hour:i,minute:b,label:o.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit",hour12:!0}),hourLabel:o.toLocaleTimeString(void 0,{hour:"numeric",hour12:!0}),key:`s-${i}-${b}`})}return n});function ve(n,i,b){return j(n).filter(o=>{const u=o.at.getHours(),_=Math.floor(o.at.getMinutes()/15)*15;return u===i&&_===b})}function he(n){return j(n).filter(i=>i.at.getHours()===0&&i.at.getMinutes()===0)}function me(n){if(O.dragging)I.x=O.originX+(n.clientX-O.startX),I.y=O.originY+(n.clientY-O.startY);else if(p.resizing){const i=Math.max(300,p.originW+(n.clientX-p.startX)),b=Math.max(260,p.originH+(n.clientY-p.startY));T.w=i,T.h=b}}function be(){O.dragging=!1,p.resizing=!1,G.value=!0,J(),H.value!==null&&(clearTimeout(H.value),H.value=null)}function $e(n){p.resizing=!0,p.startX=n.clientX,p.startY=n.clientY,p.originW=T.w,p.originH=T.h}const H=m(null);function R(n){n.button===0&&(O.startX=n.clientX,O.startY=n.clientY,O.originX=I.x,O.originY=I.y,H.value=window.setTimeout(()=>{O.dragging=!0,G.value=!1},St))}return xe(()=>{window.addEventListener("mousemove",me),window.addEventListener("mouseup",be),l.snap&&J(),W(),window.addEventListener("assignment-created",W)}),ue(()=>l.snap,()=>J()),ue(()=>x.cells[l.uid],n=>{if(!l.snap||!n||O.dragging||p.resizing)return;T.w=v.colWidth,T.h=v.rowHeight;const i=x.pxFromColRow(n.col,n.row);I.x=i.x,I.y=i.y}),ue(()=>x.version,()=>{if(!l.snap)return;T.w=v.colWidth,T.h=v.rowHeight;const n=x.cells[l.uid];if(n){const i=x.pxFromColRow(n.col,n.row);I.x=i.x,I.y=i.y}}),ye(()=>{window.removeEventListener("mousemove",me),window.removeEventListener("mouseup",be),x.release(l.uid),window.removeEventListener("assignment-created",W)}),(n,i)=>(y(),k("div",{class:ne(t(d)),style:fe(t(a)),onMousedown:R},[e("div",at,[re(e("input",{"onUpdate:modelValue":i[0]||(i[0]=b=>ce(D)?D.value=b:null),class:"font-medium w-full mr-2 border-b rounded-md px-2 py-1"},null,512),[[ge,t(D)]]),e("button",{class:"text-sm text-red-600",onClick:i[1]||(i[1]=b=>n.$emit("remove"))},"Remove")]),e("div",it,[e("div",rt,[e("button",{class:"px-2 py-1 border rounded-md",onClick:V},"<"),e("div",ut,Z(t(te)),1),e("button",{class:"px-2 py-1 border rounded-md",onClick:X},">")]),e("div",ct,[e("button",{class:ne(S("month")),onClick:i[2]||(i[2]=b=>g("month"))},"Month",2),e("button",{class:ne(S("week")),onClick:i[3]||(i[3]=b=>g("week"))},"Week",2),e("button",{class:ne(S("day")),onClick:i[4]||(i[4]=b=>g("day"))},"Day",2)])]),t(z)!=="day"?(y(),k("div",dt,[(y(),k(de,null,pe(L,b=>e("div",{class:"text-xs text-gray-500",key:b},Z(b),1)),64)),(y(!0),k(de,null,pe(t(Q),b=>(y(),k("div",{key:b.key,class:ne(["h-14 flex flex-col items-center justify-start rounded-md p-1 text-xs cursor-pointer",[b.inMonth?"bg-gray-50":"bg-white text-gray-400",E(b.date,t(M))?"ring-2 ring-blue-500":""]]),onClick:o=>B(b.date)},[e("div",gt,[e("div",mt,Z(b.date.getDate()),1),C(b.date).length?(y(),k("div",vt,Z(C(b.date).length),1)):oe("",!0)])],10,pt))),128))])):(y(),k("div",ft,[e("div",xt,Z(t(ee)),1),e("div",ht,[he(t(M)).length?(y(),k("div",wt,[i[6]||(i[6]=e("div",{class:"text-xs font-medium text-gray-700"},"Time Unassigned",-1)),e("ul",yt,[(y(!0),k(de,null,pe(he(t(M)),b=>(y(),k("li",{key:"u-"+b.id,class:"text-sm flex items-center gap-2"},[i[5]||(i[5]=e("span",{class:"inline-block w-14 text-gray-400"},"--:--",-1)),e("span",null,Z(b.title),1)]))),128))])])):oe("",!0),e("div",bt,[e("ul",null,[(y(!0),k(de,null,pe(t(N),b=>(y(),k("li",{key:b.key,class:ne(["border-b last:border-b-0",b.minute===0?"border-gray-300":"border-gray-100"])},[e("div",$t,[e("div",kt,Z(b.minute===0?b.hourLabel:""),1),e("div",Mt,[ve(t(M),b.hour,b.minute).length?(y(),k("ul",_t,[(y(!0),k(de,null,pe(ve(t(M),b.hour,b.minute),o=>(y(),k("li",{key:o.id,class:"text-sm flex items-center gap-2"},[e("span",Ct,Z($(o.at)),1),e("span",null,Z(o.title),1)]))),128))])):oe("",!0)])])],2))),128))])])])])),e("div",{class:"absolute right-1 bottom-1 w-4 h-4 cursor-se-resize",style:{"border-right":"2px solid #9ca3af","border-bottom":"2px solid #9ca3af"},onMousedown:ie($e,["stop"])},null,32)],38))}}),Lt=Object.assign(Dt,{__name:"CalendarModuleLocal"}),Yt={class:"flex items-center justify-between"},It={class:"space-y-2"},Tt={class:"text-sm text-gray-600"},Xt={class:"grid grid-cols-2 gap-2"},zt=["disabled"],Wt=["disabled"],Ot=["disabled"],Et=["disabled"],Ht={class:"text-sm space-y-1"},Rt={class:"font-medium"},At={class:"font-medium"},Pt={class:"font-medium"},Ft={class:"font-medium"},Ut=200,jt=ke({__name:"ClockModuleLocal",props:{snap:{type:Boolean},uid:{}},setup(le){const l=le,x=_e();function J(){if(!l.snap)return;d.w=v.colWidth,d.h=v.rowHeight;const P=x.colRowFromPx(a.x,a.y),c=x.requestSnap(l.uid,P),Q=x.pxFromColRow(c.col,c.row);a.x=Q.x,a.y=Q.y}const D=ze(),h=m(null),Y=q(()=>h.value?.id??D.id),C=m("Time Clock"),W=m(null),G=q(()=>new Date().toLocaleDateString());async function I(){const P=await $fetch("/api/time-entries",{query:{userId:Y.value}}),c=new Date,Q=Date.UTC(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate());W.value=P.find(E=>new Date(E.date).getTime()===Q)||null}function T(P){return P?new Date(P).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""}async function O(P){const c=new Date().getTimezoneOffset(),Q=await $fetch("/api/time-entries",{method:"POST",body:{userId:Y.value,action:P,tzOffsetMinutes:c}});W.value=Q.entry}xe(async()=>{try{h.value=await $fetch("/api/auth/me")}catch{h.value=null}I()});const p=m(!0),a=K({x:0,y:0}),d=K({w:v.colWidth,h:v.rowHeight}),L=K({dragging:!1,startX:0,startY:0,originX:0,originY:0}),s=K({resizing:!1,startX:0,startY:0,originW:0,originH:0}),M=q(()=>({width:d.w+"px",height:d.h+"px",transform:`translate(${a.x}px, ${a.y}px)`,position:l.snap?"absolute":"relative",top:l.snap?"0px":"auto",left:l.snap?"0px":"auto",boxSizing:"border-box"})),z=q(()=>["border rounded-2xl p-2 space-y-2 shadow bg-white overflow-hidden",L.dragging?"select-none cursor-grabbing z-50":"select-text cursor-default"]);function U(P){if(L.dragging)a.x=L.originX+(P.clientX-L.startX),a.y=L.originY+(P.clientY-L.startY);else if(s.resizing){const c=Math.max(280,s.originW+(P.clientX-s.startX)),Q=Math.max(200,s.originH+(P.clientY-s.startY));d.w=c,d.h=Q}}function A(){L.dragging=!1,s.resizing=!1,p.value=!0,J(),te.value!==null&&(clearTimeout(te.value),te.value=null)}function se(P){s.resizing=!0,s.startX=P.clientX,s.startY=P.clientY,s.originW=d.w,s.originH=d.h}const te=m(null);function ee(P){P.button===0&&(L.startX=P.clientX,L.startY=P.clientY,L.originX=a.x,L.originY=a.y,te.value=window.setTimeout(()=>{L.dragging=!0,p.value=!1},Ut))}return xe(()=>{window.addEventListener("mousemove",U),window.addEventListener("mouseup",A),l.snap&&J()}),ue(()=>l.snap,()=>J()),ue(()=>x.cells[l.uid],P=>{if(!l.snap||!P||L.dragging||s.resizing)return;d.w=v.colWidth,d.h=v.rowHeight;const c=x.pxFromColRow(P.col,P.row);a.x=c.x,a.y=c.y}),ue(()=>x.version,()=>{if(!l.snap)return;d.w=v.colWidth,d.h=v.rowHeight;const P=x.cells[l.uid];if(P){const c=x.pxFromColRow(P.col,P.row);a.x=c.x,a.y=c.y}}),ye(()=>{window.removeEventListener("mousemove",U),window.removeEventListener("mouseup",A),x.release(l.uid)}),(P,c)=>(y(),k("div",{class:ne(t(z)),style:fe(t(M)),onMousedown:ee},[e("div",Yt,[re(e("input",{"onUpdate:modelValue":c[0]||(c[0]=Q=>ce(C)?C.value=Q:null),class:"font-medium w-full mr-2 border-b rounded-md px-2 py-1"},null,512),[[ge,t(C)]]),e("button",{class:"text-sm text-red-600",onClick:c[1]||(c[1]=Q=>P.$emit("remove"))},"Remove")]),e("div",It,[e("div",Tt,"Today: "+Z(t(G)),1),e("div",Xt,[e("button",{class:"px-3 py-2 border rounded-md hover:bg-gray-50 disabled:opacity-50",disabled:!!t(W)?.clockIn,onClick:c[2]||(c[2]=Q=>O("clockIn"))},"Clock In",8,zt),e("button",{class:"px-3 py-2 border rounded-md hover:bg-gray-50 disabled:opacity-50",disabled:!t(W)?.clockIn||!!t(W)?.lunchOut,onClick:c[3]||(c[3]=Q=>O("lunchOut"))},"Lunch Out",8,Wt),e("button",{class:"px-3 py-2 border rounded-md hover:bg-gray-50 disabled:opacity-50",disabled:!t(W)?.lunchOut||!!t(W)?.lunchIn,onClick:c[4]||(c[4]=Q=>O("lunchIn"))},"Lunch In",8,Ot),e("button",{class:"px-3 py-2 border rounded-md hover:bg-gray-50 disabled:opacity-50",disabled:!t(W)?.clockIn||!!t(W)?.clockOut,onClick:c[5]||(c[5]=Q=>O("clockOut"))},"Clock Out",8,Et)]),e("div",Ht,[e("div",null,[c[6]||(c[6]=De("Clock In: ",-1)),e("span",Rt,Z(T(t(W)?.clockIn)||"-"),1)]),e("div",null,[c[7]||(c[7]=De("Lunch Out: ",-1)),e("span",At,Z(T(t(W)?.lunchOut)||"-"),1)]),e("div",null,[c[8]||(c[8]=De("Lunch In: ",-1)),e("span",Pt,Z(T(t(W)?.lunchIn)||"-"),1)]),e("div",null,[c[9]||(c[9]=De("Clock Out: ",-1)),e("span",Ft,Z(T(t(W)?.clockOut)||"-"),1)])])]),e("div",{class:"absolute right-1 bottom-1 w-4 h-4 cursor-se-resize",style:{"border-right":"2px solid #9ca3af","border-bottom":"2px solid #9ca3af"},onMousedown:ie(se,["stop"])},null,32)],38))}}),Nt=Object.assign(jt,{__name:"ClockModuleLocal"}),Bt={class:"flex items-center justify-between"},Vt={class:"w-full overflow-x-auto"},Gt=["viewBox"],qt=["x2"],Kt=["transform","onClick"],Jt=["y2"],Qt=["cy"],Zt=["y"],en=["y"],Se=800,tn=140,Ce=32,Me=100,nn=200,on=ke({__name:"RoadmapModuleLocal",props:{snap:{type:Boolean}},setup(le){const l=le,x=_e(),J=Math.random().toString(36).slice(2);function D(){if(!l.snap)return;M.w=v.colWidth,M.h=v.rowHeight;const E=x.colRowFromPx(s.x,s.y),B=x.requestSnap(l.uid,E),g=x.pxFromColRow(B.col,B.row);s.x=g.x,s.y=g.y}const h=m("Road Map"),Y=m(""),C=m(""),W=m([]),G=q(()=>W.value.slice().sort((E,B)=>new Date(E.date).getTime()-new Date(B.date).getTime()));function I(){!Y.value||!C.value||(W.value.push({description:Y.value,date:C.value}),Y.value="",C.value="")}function T(E){W.value.splice(E,1)}function O(E){const B=new Date(E);return Number.isNaN(B.getTime())?E:B.toLocaleDateString(void 0,{month:"short",day:"numeric"})}const p=q(()=>W.value.length===0?null:new Date(Math.min(...W.value.map(E=>new Date(E.date).getTime())))),a=q(()=>W.value.length===0?null:new Date(Math.max(...W.value.map(E=>new Date(E.date).getTime()))));function d(E){const B=new Date(E);if(!p.value||!a.value)return Se/2;const g=p.value.getTime(),S=a.value.getTime();if(S===g)return(Se-2*Ce)/2+Ce;const V=(B.getTime()-g)/(S-g);return Ce+V*(Se-2*Ce)}const L=m(!0),s=K({x:0,y:0}),M=K({w:v.colWidth,h:v.rowHeight}),z=K({dragging:!1,startX:0,startY:0,originX:0,originY:0}),U=K({resizing:!1,startX:0,startY:0,originW:0,originH:0}),A=q(()=>({width:M.w+"px",height:M.h+"px",transform:`translate(${s.x}px, ${s.y}px)`,position:l.snap?"absolute":"relative",top:l.snap?"0px":"auto",left:l.snap?"0px":"auto",boxSizing:"border-box"})),se=q(()=>["border rounded-2xl p-2 space-y-2 shadow bg-white overflow-hidden",z.dragging?"select-none cursor-grabbing z-50":"select-text cursor-default"]);function te(E){if(z.dragging)s.x=z.originX+(E.clientX-z.startX),s.y=z.originY+(E.clientY-z.startY);else if(U.resizing){const B=Math.max(300,U.originW+(E.clientX-U.startX)),g=Math.max(220,U.originH+(E.clientY-U.startY));M.w=B,M.h=g}}function ee(){z.dragging=!1,U.resizing=!1,L.value=!0,D(),c.value!==null&&(clearTimeout(c.value),c.value=null)}function P(E){U.resizing=!0,U.startX=E.clientX,U.startY=E.clientY,U.originW=M.w,U.originH=M.h}const c=m(null);function Q(E){E.button===0&&(z.startX=E.clientX,z.startY=E.clientY,z.originX=s.x,z.originY=s.y,c.value=window.setTimeout(()=>{z.dragging=!0,L.value=!1},nn))}return xe(()=>{window.addEventListener("mousemove",te),window.addEventListener("mouseup",ee),l.snap&&D()}),ue(()=>l.snap,()=>D()),ue(()=>x.cells[l.uid],E=>{if(!l.snap||!E||z.dragging||U.resizing)return;M.w=v.colWidth,M.h=v.rowHeight;const B=x.pxFromColRow(E.col,E.row);s.x=B.x,s.y=B.y}),ue(()=>x.version,()=>{if(!l.snap)return;M.w=v.colWidth,M.h=v.rowHeight;const E=x.cells[J];if(E){const B=x.pxFromColRow(E.col,E.row);s.x=B.x,s.y=B.y}}),ye(()=>{window.removeEventListener("mousemove",te),window.removeEventListener("mouseup",ee),x.release(l.uid)}),(E,B)=>(y(),k("div",{class:ne(t(se)),style:fe(t(A)),onMousedown:Q},[e("div",Bt,[re(e("input",{"onUpdate:modelValue":B[0]||(B[0]=g=>ce(h)?h.value=g:null),class:"font-medium w-full mr-2 border-b rounded-md px-2 py-1"},null,512),[[ge,t(h)]]),e("button",{class:"text-sm text-red-600",onClick:B[1]||(B[1]=g=>E.$emit("remove"))},"Remove")]),e("form",{class:"flex flex-col md:flex-row gap-2",onSubmit:ie(I,["prevent"])},[re(e("input",{"onUpdate:modelValue":B[2]||(B[2]=g=>ce(Y)?Y.value=g:null),placeholder:"Short description",class:"border rounded-md px-2 py-1 flex-1"},null,512),[[ge,t(Y)]]),re(e("input",{"onUpdate:modelValue":B[3]||(B[3]=g=>ce(C)?C.value=g:null),type:"date",class:"border rounded-md px-2 py-1"},null,512),[[ge,t(C)]]),B[4]||(B[4]=e("button",{class:"bg-gray-800 text-white px-2 py-1 rounded-md"},"Add",-1))],32),e("div",Vt,[(y(),k("svg",{viewBox:`0 0 ${Se} ${tn}`,class:"w-full min-w-[600px]",preserveAspectRatio:"xMidYMid meet"},[e("line",{x1:Ce,x2:Se-Ce,y1:Me,y2:Me,stroke:"#111827","stroke-width":"2"},null,8,qt),(y(!0),k(de,null,pe(t(G),(g,S)=>(y(),k("g",{key:S,transform:`translate(${d(g.date)},0)`,class:"cursor-pointer",onClick:V=>T(S)},[e("line",{x1:0,x2:0,y1:Me,y2:Me-32,stroke:"#6b7280","stroke-width":"2"},null,8,Jt),e("circle",{cx:0,cy:Me-34,r:"5",fill:"#111827"},null,8,Qt),e("text",{x:0,y:Me-44,"text-anchor":"middle",class:"fill-gray-800",style:{"font-size":"10px"}},Z(O(g.date)),9,Zt),e("text",{x:0,y:Me-58,"text-anchor":"middle",class:"fill-gray-700",style:{"font-size":"11px"}},Z(g.description),9,en)],8,Kt))),128))],8,Gt))]),e("div",{class:"absolute right-1 bottom-1 w-4 h-4 cursor-se-resize",style:{"border-right":"2px solid #9ca3af","border-bottom":"2px solid #9ca3af"},onMousedown:ie(P,["stop"])},null,32)],38))}}),sn=Object.assign(on,{__name:"RoadmapModuleLocal"}),ln={class:"space-y-2 relative"},an={class:"flex flex-wrap items-end justify-between gap-2 pr-14"},rn={class:"flex flex-wrap items-end gap-2 w-full md:w-auto order-3 md:order-2"},un={key:0,class:"order-3 md:order-2 flex flex-col gap-2 flex-1 min-w-[260px]"},cn={class:"flex items-end gap-2 flex-1 min-w-[320px] flex-wrap md:flex-nowrap"},dn={class:"flex flex-col"},pn=["value"],gn={class:"flex items-end gap-2 flex-wrap"},mn={class:"flex items-end gap-2 order-1"},vn={class:"flex flex-col"},fn={class:"flex flex-col"},xn={class:"flex flex-col order-2"},hn={class:"w-28 order-3"},wn=["disabled"],yn={class:"absolute top-1 right-2"},bn={class:"mt-1"},$n={key:0,class:"flex items-end justify-between mb-1"},kn={key:1,class:"flex items-end justify-between mb-1"},Mn={key:2,class:"space-y-1"},_n={class:"flex items-center gap-2 min-w-0"},Cn=["onChange"],Sn={class:"truncate"},Dn={class:"text-xs text-gray-500 ml-auto w-28 text-right"},Ln={key:0,class:"text-sm text-gray-500"},Yn={key:3,class:"space-y-1"},In={class:"flex items-center gap-2 min-w-0"},Tn={class:"truncate"},Xn={class:"flex items-center gap-4"},zn={class:"text-xs text-gray-500 w-40 text-right truncate"},Wn={class:"text-xs text-gray-500 w-28 text-right"},On={key:0,class:"text-sm text-gray-500"},En={key:0,class:"absolute left-2 bottom-2"},Hn={class:"inline-flex border rounded-full overflow-hidden shadow bg-white pointer-events-auto"},Rn=ke({__name:"AssignmentsModuleLocal",props:{snap:{type:Boolean},uid:{}},setup(le){const l=le,x=_e();function J(){if(!l.snap)return;h.w=v.colWidth,h.h=v.rowHeight;const j=x.colRowFromPx(D.x,D.y),$=x.requestSnap(l.uid,j),N=x.pxFromColRow($.col,$.row);D.x=N.x,D.y=N.y}const D=K({x:0,y:0}),h=K({w:v.colWidth,h:v.rowHeight}),Y=K({dragging:!1,startX:0,startY:0,originX:0,originY:0}),C=K({resizing:!1,startX:0,startY:0,originW:0,originH:0}),W=q(()=>({width:h.w+"px",height:h.h+"px",transform:`translate(${D.x}px, ${D.y}px)`,position:l.snap?"absolute":"relative",top:l.snap?"0px":"auto",left:l.snap?"0px":"auto",boxSizing:"border-box"})),G=q(()=>["border rounded-2xl p-2 shadow bg-white overflow-x-hidden overflow-y-auto relative",Y.dragging?"select-none cursor-grabbing z-50":"select-text cursor-default"]);function I(j){if(Y.dragging)D.x=Y.originX+(j.clientX-Y.startX),D.y=Y.originY+(j.clientY-Y.startY);else if(C.resizing){const $=Math.max(300,C.originW+(j.clientX-C.startX)),N=Math.max(260,C.originH+(j.clientY-C.startY));h.w=$,h.h=N}}function T(){Y.dragging=!1,C.resizing=!1,l.snap&&J()}function O(j){j.button===0&&(Y.dragging=!0,Y.startX=j.clientX,Y.startY=j.clientY,Y.originX=D.x,Y.originY=D.y)}function p(j){C.resizing=!0,C.startX=j.clientX,C.startY=j.clientY,C.originW=h.w,C.originH=h.h}xe(()=>{window.addEventListener("mousemove",I),window.addEventListener("mouseup",T),l.snap&&J()}),ue(()=>x.cells[l.uid],j=>{if(!l.snap||!j||Y.dragging||C.resizing)return;h.w=v.colWidth,h.h=Math.max(v.rowHeight,320);const $=x.pxFromColRow(j.col,j.row);D.x=$.x,D.y=$.y}),ue(()=>x.version,()=>{if(!l.snap)return;h.w=v.colWidth,h.h=Math.max(v.rowHeight,320);const j=x.cells[l.uid];if(j){const $=x.pxFromColRow(j.col,j.row);D.x=$.x,D.y=$.y}}),ye(()=>{window.removeEventListener("mousemove",I),window.removeEventListener("mouseup",T),x.release(l.uid)});const a=m(null),d=m([]),L=m([]),s=m([]),M=K({}),z=q(()=>a.value?c.value?a.value.role==="OWNER"||a.value.role==="ADMIN_MANAGER"?s.value:s.value.filter(j=>j.role!=="ADMIN"):[]:[]),U=m(""),A=m(0),se=m("me"),te=m(""),ee=m(""),P=m(""),c=q(()=>a.value&&(a.value.role==="OWNER"||a.value.role==="MANAGER"||a.value.role==="ADMIN_MANAGER")),Q=q(()=>c.value&&U.value.trim()&&A.value>0);async function E(){try{a.value=await $fetch("/api/auth/me")}catch{a.value=null}}async function B(){try{const j=await $fetch("/api/users");s.value=j.map($=>({id:$.id,name:$.name,role:$.role}));for(const $ of s.value)M[$.id]=$}catch{}}async function g(){d.value=await $fetch("/api/assignments?view=me"),c.value?L.value=await $fetch("/api/assignments?view=authored"):L.value=[]}async function S(){if(!Q.value)return;const j=(()=>{if(te.value)return ee.value?`${te.value}T${ee.value}`:te.value})();await $fetch("/api/assignments",{method:"POST",body:{title:U.value.trim(),assignedToId:A.value,dueDate:j,recurrence:P.value||void 0}});try{window.dispatchEvent(new CustomEvent("assignment-created",{detail:{assignedToId:A.value}}))}catch{}U.value="",A.value=0,te.value="",ee.value="",P.value="",await g()}async function V(j){await $fetch("/api/assignments",{method:"PUT",body:{id:j,completed:!0}}),await g()}xe(async()=>{await E(),await Promise.all([B(),g()])}),ue(se,async()=>{await g()});function X(j){if(!j)return"";try{const $=new Date(j);return $.getHours()!==0||$.getMinutes()!==0||$.getSeconds()!==0?$.toLocaleString(void 0,{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):$.toLocaleDateString()}catch{return""}}return(j,$)=>(y(),k("div",{class:ne(t(G)),style:fe(t(W)),onMousedown:O},[e("div",ln,[e("div",an,[$[14]||($[14]=e("h3",{class:"font-medium mr-2"},"Assignments",-1)),e("div",rn,[t(c)?(y(),k("div",un,[e("div",cn,[re(e("input",{"onUpdate:modelValue":$[0]||($[0]=N=>ce(U)?U.value=N:null),placeholder:"New task",class:"border rounded px-2 h-8 text-sm w-40 md:w-48 flex-1"},null,512),[[ge,t(U)]]),e("div",dn,[$[9]||($[9]=e("label",{class:"text-[10px] leading-none uppercase tracking-wide text-gray-500 mb-1"},"Employee",-1)),re(e("select",{"onUpdate:modelValue":$[1]||($[1]=N=>ce(A)?A.value=N:null),class:"border rounded px-2 h-8 text-sm min-w-[140px]"},[$[8]||($[8]=e("option",{value:0},"Select user",-1)),(y(!0),k(de,null,pe(t(z),N=>(y(),k("option",{key:N.id,value:N.id},Z(N.name),9,pn))),128))],512),[[Le,t(A),void 0,{number:!0}]])])]),e("div",gn,[e("div",mn,[e("div",vn,[$[10]||($[10]=e("label",{class:"text-[10px] leading-none uppercase tracking-wide text-gray-500 mb-1"},"Date",-1)),re(e("input",{type:"date","onUpdate:modelValue":$[2]||($[2]=N=>ce(te)?te.value=N:null),class:"border rounded px-2 h-8 text-sm"},null,512),[[ge,t(te)]])]),e("div",fn,[$[11]||($[11]=e("label",{class:"text-[10px] leading-none uppercase tracking-wide text-gray-500 mb-1"},"Time",-1)),re(e("input",{type:"time","onUpdate:modelValue":$[3]||($[3]=N=>ce(ee)?ee.value=N:null),class:"border rounded px-2 h-8 text-sm w-[110px]"},null,512),[[ge,t(ee)]])])]),e("div",xn,[$[13]||($[13]=e("label",{class:"text-[10px] leading-none uppercase tracking-wide text-gray-500 mb-1"},"Recurring",-1)),re(e("select",{"onUpdate:modelValue":$[4]||($[4]=N=>ce(P)?P.value=N:null),class:"border rounded px-2 h-8 text-sm min-w-[130px]"},[...$[12]||($[12]=[Oe('<option value="">One-time</option><option value="DAILY">Daily</option><option value="WEEKLY">Weekly</option><option value="BI_WEEKLY">Bi-Weekly</option><option value="MONTHLY">Monthly</option>',5)])],512),[[Le,t(P)]])]),e("div",hn,[e("button",{class:"px-3 h-8 text-sm border rounded w-full",disabled:!t(Q),onClick:S},"Assign",8,wn)])])])):oe("",!0)])]),e("div",yn,[e("button",{class:"text-sm text-red-600",onClick:$[5]||($[5]=N=>j.$emit("remove"))},"Remove")]),e("div",bn,[!t(c)||t(se)==="me"?(y(),k("div",$n,[...$[15]||($[15]=[e("div",{class:"text-sm font-medium"},"Assigned to me",-1),e("span",{class:"text-xs font-bold text-gray-700 w-28 text-right"},"Due date",-1)])])):(y(),k("div",kn,[...$[16]||($[16]=[e("div",{class:"text-sm font-medium"},"Assignments",-1),e("div",{class:"flex items-center gap-4"},[e("span",{class:"text-xs font-bold text-gray-700 w-40 text-right"},"Employee"),e("span",{class:"text-xs font-bold text-gray-700 w-28 text-right"},"Due date")],-1)])])),!t(c)||t(se)==="me"?(y(),k("ul",Mn,[(y(!0),k(de,null,pe(t(d),N=>(y(),k("li",{key:N.id,class:"flex items-center gap-2"},[e("div",_n,[e("input",{type:"checkbox",checked:!1,onChange:ve=>V(N.id)},null,40,Cn),e("span",Sn,Z(N.title),1)]),e("span",Dn,Z(X(N.dueDate)),1)]))),128)),t(d).length===0?(y(),k("li",Ln,"No assignments")):oe("",!0)])):(y(),k("ul",Yn,[(y(!0),k(de,null,pe(t(L),N=>(y(),k("li",{key:N.id,class:"flex items-center justify-between gap-2"},[e("div",In,[$[17]||($[17]=e("span",null,"•",-1)),e("span",Tn,Z(N.title),1)]),e("div",Xn,[e("span",zn,Z(t(M)[N.assignedToId]?.name||N.assignedToId),1),e("span",Wn,Z(X(N.dueDate)),1)])]))),128)),t(L).length===0?(y(),k("li",On,"No pending authored assignments")):oe("",!0)]))])]),t(c)?(y(),k("div",En,[e("div",Hn,[e("button",{class:ne(["px-3 h-8 text-sm",t(se)==="me"?"bg-black text-white":"bg-white"]),onClick:$[6]||($[6]=N=>se.value="me")},"Assigned to me",2),e("button",{class:ne(["px-3 h-8 text-sm",t(se)==="authored"?"bg-black text-white":"bg-white"]),onClick:$[7]||($[7]=N=>se.value="authored")},"Assignments",2)])])):oe("",!0),e("div",{class:"absolute right-1 bottom-1 w-4 h-4 cursor-se-resize",style:{"border-right":"2px solid #9ca3af","border-bottom":"2px solid #9ca3af"},onMousedown:ie(p,["stop"])},null,32)],38))}}),An=Object.assign(Rn,{__name:"AssignmentsModuleLocal"}),Pn={class:"flex items-center justify-between"},Fn={class:"inline-flex items-center gap-2"},Un=["value"],jn=["disabled"],Nn=["disabled"],Bn={class:"space-y-1"},Vn=["href"],Gn={key:0,class:"text-gray-400 text-xs"},qn=["onClick"],Kn={key:0,class:"text-red-600 text-sm"},Jn=200,Qn=ke({__name:"AttachmentsModuleLocal",props:{snap:{type:Boolean},uid:{},projectId:{}},setup(le){const l=le,x=_e(),J=m("Attachments"),D=m("shared"),h=m([]),Y=m(!1),C=m(null),W=m(""),G=m([]),I=m(null),T=K({x:0,y:0}),O=K({w:v.colWidth,h:v.rowHeight*2}),p=K({dragging:!1,startX:0,startY:0,originX:0,originY:0}),a=K({resizing:!1,startX:0,startY:0,originW:0,originH:0}),d=m(null),L=q(()=>({width:O.w+"px",height:O.h+"px",transform:`translate(${T.x}px, ${T.y}px)`,position:l.snap?"absolute":"relative",top:l.snap?"0px":"auto",left:l.snap?"0px":"auto",boxSizing:"border-box"})),s=q(()=>["border rounded-2xl p-2 space-y-2 shadow bg-white overflow-hidden",p.dragging?"select-none cursor-grabbing z-50":"select-text cursor-default"]);function M(){if(!l.snap)return;O.w=v.colWidth,O.h=v.rowHeight*2;const g=x.colRowFromPx(T.x,T.y),S=x.requestSnap(l.uid,g),V=x.pxFromColRow(S.col,S.row);T.x=V.x,T.y=V.y}function z(g){g.button===0&&(p.startX=g.clientX,p.startY=g.clientY,p.originX=T.x,p.originY=T.y,d.value=window.setTimeout(()=>{p.dragging=!0},Jn))}function U(g){a.resizing=!0,a.startX=g.clientX,a.startY=g.clientY,a.originW=O.w,a.originH=O.h}function A(g){p.dragging?(T.x=p.originX+(g.clientX-p.startX),T.y=p.originY+(g.clientY-p.startY)):a.resizing&&(O.w=Math.max(260,a.originW+(g.clientX-a.startX)),O.h=Math.max(220,a.originH+(g.clientY-a.startY)))}function se(){p.dragging=!1,a.resizing=!1,d.value!==null&&(clearTimeout(d.value),d.value=null),l.snap&&M()}xe(()=>{window.addEventListener("mousemove",A),window.addEventListener("mouseup",se),l.snap&&M(),te()}),ye(()=>{window.removeEventListener("mousemove",A),window.removeEventListener("mouseup",se),x.release(l.uid)}),ue(()=>x.cells[l.uid],g=>{if(!l.snap||!g||p.dragging||a.resizing)return;O.w=v.colWidth,O.h=v.rowHeight*2;const S=x.pxFromColRow(g.col,g.row);T.x=S.x,T.y=S.y}),ue(D,ee),ue(I,ee);async function te(){await B(),await ee()}async function ee(){W.value="";const g=I.value||null;if(!g){h.value=[];return}try{h.value=await $fetch(`/api/files/${g}?scope=${D.value}`)}catch(S){W.value=S?.data?.message||S?.message||"Failed to load files"}}async function P(){W.value="";const g=I.value||null;if(!g||!C.value||!C.value.files||C.value.files.length===0)return;const S=C.value.files[0],V=new FormData;V.append("file",S),Y.value=!0;try{const X=await $fetch(`/api/files/${g}?scope=${D.value}`,{method:"POST",body:V});h.value.unshift(X),C.value&&(C.value.value="")}catch(X){W.value=X?.data?.message||X?.message||"Upload failed"}finally{Y.value=!1}}async function c(g){W.value="";const S=I.value||null;if(S)try{await $fetch(`/api/files/${S}?id=${g.id}`,{method:"DELETE"}),h.value=h.value.filter(V=>V.id!==g.id)}catch(V){W.value=V?.data?.message||V?.message||"Delete failed"}}function Q(g){try{return g.split("/").filter(Boolean).pop()||g}catch{return g}}function E(g){const S=g?.metadata?.size;return!S||typeof S!="number"?"":S<1024?`${S} B`:S<1024*1024?`${Math.round(S/1024)} KB`:`${(S/1024/1024).toFixed(1)} MB`}async function B(){try{const g=await $fetch("/api/projects");if(G.value=Array.isArray(g)?g.map(S=>({id:S.id,name:S.name})):[],I.value||(I.value=G.value[0]?.id??null),!I.value&&G.value.length===0)try{const S=await $fetch("/api/projects",{method:"POST",body:{name:"General",slug:"general"}});S?.id&&(G.value=[{id:S.id,name:S.name}],I.value=S.id)}catch{}}catch{}}return(g,S)=>(y(),k("div",{class:ne(t(s)),style:fe(t(L)),onMousedown:z},[e("div",Pn,[re(e("input",{"onUpdate:modelValue":S[0]||(S[0]=V=>ce(J)?J.value=V:null),class:"font-medium w-full mr-2 border-b rounded-md px-2 py-1"},null,512),[[ge,t(J)]]),e("div",Fn,[re(e("select",{"onUpdate:modelValue":S[1]||(S[1]=V=>ce(I)?I.value=V:null),class:"border rounded px-2 py-1 text-sm",onChange:ee},[(y(!0),k(de,null,pe(t(G),V=>(y(),k("option",{key:V.id,value:V.id},Z(V.name),9,Un))),128))],544),[[Le,t(I),void 0,{number:!0}]]),re(e("select",{"onUpdate:modelValue":S[2]||(S[2]=V=>ce(D)?D.value=V:null),class:"border rounded px-2 py-1 text-sm"},[...S[4]||(S[4]=[e("option",{value:"shared"},"Shared",-1),e("option",{value:"private"},"My Files",-1)])],512),[[Le,t(D)]]),e("button",{class:"text-sm text-red-600",onClick:S[3]||(S[3]=V=>g.$emit("remove"))},"Remove")])]),e("form",{class:"flex items-center gap-2",onSubmit:ie(P,["prevent"])},[e("input",{ref_key:"fileInput",ref:C,type:"file",disabled:t(Y)},null,8,jn),e("button",{class:"bg-gray-800 text-white px-3 py-1 rounded disabled:opacity-50",disabled:t(Y)},Z(t(Y)?"Uploading...":"Upload"),9,Nn)],32),e("ul",Bn,[(y(!0),k(de,null,pe(t(h),V=>(y(),k("li",{key:V.id,class:"flex items-center gap-2"},[e("a",{class:"text-blue-600 underline",href:V.path,target:"_blank"},Z(Q(V.path)),9,Vn),E(V)?(y(),k("span",Gn,"("+Z(E(V))+")",1)):oe("",!0),e("button",{class:"text-red-600 text-sm ml-auto",onClick:X=>c(V)},"Delete",8,qn)]))),128))]),t(W)?(y(),k("div",Kn,Z(t(W)),1)):oe("",!0),e("div",{class:"absolute right-1 bottom-1 w-4 h-4 cursor-se-resize",style:{"border-right":"2px solid #9ca3af","border-bottom":"2px solid #9ca3af"},onMousedown:ie(U,["stop"])},null,32)],38))}}),Zn=Object.assign(Qn,{__name:"AttachmentsModuleLocal"}),eo={class:"fixed inset-0 z-50 bg-black/60 flex items-center justify-center"},to={class:"bg-white rounded-lg shadow-xl w-[92vw] max-w-5xl p-4"},no={class:"flex items-center justify-between mb-3"},oo={class:"flex flex-col md:flex-row gap-4"},so={class:"flex-1"},lo=["src"],ao=["onMousedown"],io={class:"mt-3 flex flex-wrap items-center gap-2 md:gap-3 justify-end w-full"},ro=["disabled"],uo=ke({__name:"BannerCropper",props:{file:{},targetWidth:{},targetHeight:{}},emits:["cancel","confirm"],setup(le,{emit:l}){const x=le,J=l,D=m(null),h=m(0),Y=m(0),C=m("image/jpeg"),W=q(()=>x.targetWidth/x.targetHeight),G=q(()=>Math.min(1e3,Math.max(480,Math.min(window.innerWidth*.9,x.targetWidth)))),I=q(()=>Math.round(G.value/W.value)),T=m(1),O=m(.2),p=K({x:0,y:0}),a=m(!1),d=m(null),L=m(null),s=q({get:()=>Math.round((T.value-O.value)*100),set:H=>M(O.value+H/100)});function M(H){T.value=Math.max(O.value,Math.min(5,H)),z()}function z(){const H=h.value*T.value,R=Y.value*T.value,n=G.value,i=I.value,b=Math.min(0,n-H),o=Math.min(0,i-R);p.x=Math.min(0,Math.max(b,p.x)),p.y=Math.min(0,Math.max(o,p.y))}const U=q(()=>({position:"absolute",left:p.x+"px",top:p.y+"px",width:h.value*T.value+"px",height:Y.value*T.value+"px"})),A=K({x:0,y:0,w:300,h:100}),se=[{key:"tl",pos:"tl",style:{left:"-6px",top:"-6px",width:"12px",height:"12px",cursor:"nwse-resize"}},{key:"tr",pos:"tr",style:{right:"-6px",top:"-6px",width:"12px",height:"12px",cursor:"nesw-resize"}},{key:"bl",pos:"bl",style:{left:"-6px",bottom:"-6px",width:"12px",height:"12px",cursor:"nesw-resize"}},{key:"br",pos:"br",style:{right:"-6px",bottom:"-6px",width:"12px",height:"12px",cursor:"nwse-resize"}}],te=q(()=>({left:A.x+"px",top:A.y+"px",width:A.w+"px",height:A.h+"px"}));function ee(H){const R=H.target;h.value=R.naturalWidth,Y.value=R.naturalHeight;const n=Math.max(G.value/h.value,I.value/Y.value);T.value=Math.max(O.value,n),P(),A.x=0,A.y=0,A.w=G.value,A.h=I.value,a.value=!0}function P(){const H=h.value*T.value,R=Y.value*T.value;p.x=(G.value-H)/2,p.y=(I.value-R)/2,z()}const c=K({on:!1,sx:0,sy:0,ox:0,oy:0});function Q(H){c.on=!0,c.sx=H.clientX,c.sy=H.clientY,c.ox=p.x,c.oy=p.y,window.addEventListener("mousemove",E),window.addEventListener("mouseup",B)}function E(H){c.on&&(p.x=c.ox+(H.clientX-c.sx),p.y=c.oy+(H.clientY-c.sy),z())}function B(){c.on=!1,window.removeEventListener("mousemove",E),window.removeEventListener("mouseup",B)}function g(H){const R=H.touches[0];c.on=!0,c.sx=R.clientX,c.sy=R.clientY,c.ox=p.x,c.oy=p.y,window.addEventListener("touchmove",S),window.addEventListener("touchend",V)}function S(H){if(!c.on)return;const R=H.touches[0];p.x=c.ox+(R.clientX-c.sx),p.y=c.oy+(R.clientY-c.sy),z()}function V(){c.on=!1,window.removeEventListener("touchmove",S),window.removeEventListener("touchend",V)}const X=K({on:!1,mode:"move",sx:0,sy:0,ox:0,oy:0,ow:0,oh:0});function j(H){X.on=!0,X.mode="move",X.sx=H.clientX,X.sy=H.clientY,X.ox=A.x,X.oy=A.y,window.addEventListener("mousemove",N),window.addEventListener("mouseup",ve)}function $(H,R){X.on=!0,X.mode=H,X.sx=R.clientX,X.sy=R.clientY,X.ox=A.x,X.oy=A.y,X.ow=A.w,X.oh=A.h,window.addEventListener("mousemove",N),window.addEventListener("mouseup",ve)}function N(H){if(!X.on)return;const R=H.clientX-X.sx,n=H.clientY-X.sy,i=G.value,b=I.value;if(X.mode==="move"){A.x=Math.min(i-A.w,Math.max(0,X.ox+R)),A.y=Math.min(b-A.h,Math.max(0,X.oy+n));return}let o=X.ox,u=X.oy,_=X.ow,F=X.oh;X.mode==="tl"&&(o=X.ox+R,u=X.oy+n,_=X.ow-R,F=X.oh-n),X.mode==="tr"&&(u=X.oy+n,_=X.ow+R,F=X.oh-n),X.mode==="bl"&&(o=X.ox+R,_=X.ow-R,F=X.oh+n),X.mode==="br"&&(_=X.ow+R,F=X.oh+n),_=Math.max(32,Math.min(i-o,_)),F=Math.max(32,Math.min(b-u,F)),o=Math.max(0,Math.min(i-_,o)),u=Math.max(0,Math.min(b-F,u)),A.x=o,A.y=u,A.w=_,A.h=F}function ve(){X.on=!1,window.removeEventListener("mousemove",N),window.removeEventListener("mouseup",ve)}async function he(){if(!a.value)return;const H=document.createElement("canvas");H.width=x.targetWidth,H.height=x.targetHeight;const R=H.getContext("2d"),n=new Image;n.src=D.value,await n.decode();const i=1/T.value,b=Math.max(0,(A.x-p.x)*i),o=Math.max(0,(A.y-p.y)*i),u=Math.min(h.value-b,A.w*i),_=Math.min(Y.value-o,A.h*i);R.imageSmoothingQuality="high",R.drawImage(n,b,o,u,_,0,0,H.width,H.height);const F=C.value==="image/jpeg"?.98:void 0,f=await new Promise(r=>H.toBlob(w=>r(w),C.value,F));J("confirm",f)}xe(()=>{$e(x.file)}),ye(()=>{D.value&&URL.revokeObjectURL(D.value)});function me(){L.value?.click()}function be(H){const R=H.target;!R.files||R.files.length===0||($e(R.files[0]),R.value="")}function $e(H){D.value&&URL.revokeObjectURL(D.value),D.value=URL.createObjectURL(H),a.value=!1,h.value=0,Y.value=0,T.value=1,O.value=1,p.x=0,p.y=0;const R=(H.type||"").toLowerCase();R.includes("png")?C.value="image/png":R.includes("webp")?C.value="image/webp":C.value="image/jpeg"}return(H,R)=>(y(),k("div",eo,[e("div",to,[e("div",no,[R[3]||(R[3]=e("h3",{class:"text-lg font-medium"},"Adjust Banner",-1)),e("button",{class:"px-2 py-1 border rounded",onClick:R[0]||(R[0]=n=>H.$emit("cancel"))},"Cancel")]),e("div",oo,[e("div",so,[e("div",{ref_key:"frame",ref:d,class:"relative bg-gray-200 overflow-hidden mx-auto",style:fe({width:t(G)+"px",height:t(I)+"px"}),onMousedown:Q,onTouchstart:ie(g,["prevent"])},[t(D)?(y(),k("img",{key:0,src:t(D),style:fe(t(U)),class:"select-none pointer-events-none",onLoad:ee},null,44,lo)):oe("",!0),e("div",{class:"absolute border-2 border-white/90 shadow-[0_0_0_10000px_rgba(0,0,0,0.35)] cursor-move",style:fe(t(te)),onMousedown:R[1]||(R[1]=ie(n=>j(n),["stop"]))},[(y(),k(de,null,pe(se,n=>e("div",{key:n.key,class:"absolute bg-white border border-gray-400",style:fe(n.style),onMousedown:ie(i=>$(n.pos,i),["stop"])},null,44,ao)),64))],36)],36),e("div",io,[R[4]||(R[4]=e("label",{class:"text-sm text-gray-600"},"Zoom",-1)),re(e("input",{type:"range",min:"0",max:"200","onUpdate:modelValue":R[2]||(R[2]=n=>ce(s)?s.value=n:null),class:"w-40 h-1.5"},null,512),[[ge,t(s),void 0,{number:!0}]]),e("button",{class:"px-3 py-1 border rounded",onClick:P},"Center"),e("button",{class:"px-3 py-1 border rounded",onClick:me},"Change Image"),e("input",{ref_key:"fileInput",ref:L,type:"file",accept:"image/*",class:"hidden",onChange:be},null,544),e("button",{class:"px-3 py-1 rounded bg-black text-white disabled:opacity-50",disabled:!t(a),onClick:he},"Save",8,ro)])])])])]))}}),co=Object.assign(uo,{__name:"BannerCropper"}),po={class:"relative p-6 space-y-4"},go={class:"flex items-center justify-between gap-2 relative"},mo={class:"w-full"},vo={class:"relative mx-auto max-w-3xl border rounded-md h-40 flex items-end justify-center bg-gray-50 overflow-hidden"},fo=["src"],xo={key:1,class:"absolute bottom-2 right-2"},ho={key:0,class:"absolute right-0 bottom-8 w-40 bg-white border rounded-md shadow-md z-50"},wo=["disabled"],yo={class:"mx-auto max-w-3xl text-center mt-2"},bo={key:1,class:"text-2xl font-semibold inline-flex items-center gap-2"},$o={class:"absolute right-4 -top-2 flex flex-col items-end gap-2"},ko={class:"relative"},Mo={key:0,class:"absolute right-0 mt-2 w-40 bg-white border rounded-md shadow-md z-50"},_o={class:"relative"},Co={key:0,class:"absolute right-0 mt-2 w-56 bg-white border rounded-md shadow-md z-50"},So=["onClick"],Do={key:0,class:"text-xs text-gray-500"},Lo={key:0,class:"border-t"},Yo=["disabled"],Io={class:"fixed bottom-4 right-4 z-50 flex items-center gap-3"},To={class:"fixed bottom-4 left-4"},Xo={class:"inline-flex border rounded-full overflow-hidden shadow bg-white"},zo={class:"inline-flex border rounded-full overflow-hidden shadow bg-white"},Wo={key:0,class:"fixed inset-0 bg-black/30 flex items-center justify-center z-50"},Oo={class:"bg-white rounded-md p-4 w-96 space-y-3"},Eo={class:"flex justify-end gap-2"},Ho=["disabled"],Ro=1024,Ao=256,Uo=ke({__name:"index",setup(le){const l=m([]),x=m(!1),J=m(!1),D=m([]),h=m(null),Y=m(!1),C=m(""),W=ze(),G=m(null),I=m(null),T=m(null),O=q(()=>G.value?G.value.role==="ADMIN"||G.value.role==="OWNER":W.role==="ADMIN"||W.role==="OWNER"),p=m("Home"),a=m(!1),d=m("Home"),L=m(null),s=m(!1),M=m(!1),z=_e(),U=m("medium"),A=m(null),se=m(v.COLS*v.colWidth+(v.COLS-1)*v.gutterX),te=m(v.ROWS*v.rowHeight+(v.ROWS-1)*v.gutterY);v.stepX,v.stepY;function ee(){if(!A.value)return;const f=v.COLS*v.colWidth+(v.COLS-1)*v.gutterX;f>0&&(se.value=f,te.value=v.ROWS*v.rowHeight+(v.ROWS-1)*v.gutterY,z.updateMaxCols(f))}xe(()=>{ee(),window.addEventListener("resize",ee)}),ye(()=>{window.removeEventListener("resize",ee)});function P(f){U.value=f,z.setSizePreset(f),Te(()=>ee())}async function c(){const f=await $fetch("/api/banner");I.value=f.url}async function Q(){const f=await $fetch("/api/site-title");p.value=f.title}async function E(f){const r=f.target;!r.files||r.files.length===0||(L.value=r.files[0],r.value="")}async function B(f){const r=new FormData,w=f.type||"image/jpeg",ae=w.includes("png")?"png":w.includes("webp")?"webp":"jpg";r.append("file",new File([f],`banner.${ae}`,{type:w}));const we=await $fetch("/api/banner",{method:"POST",body:r});I.value=we.url,L.value=null}function g(){d.value=p.value,a.value=!0}function S(){a.value=!1}async function V(){await $fetch("/api/site-title",{method:"POST",body:{title:d.value}}),a.value=!1,await Q()}function X(){x.value=!x.value}function j(){J.value=!J.value}function $(){s.value=!s.value}function N(){s.value=!1,T.value?.click()}async function ve(){if(s.value=!1,!!I.value)try{const r=await(await fetch(I.value)).blob();L.value=new File([r],"banner-current.jpg",{type:r.type||"image/jpeg"})}catch{}}function he(f){f.target,s.value&&(s.value=!1),J.value&&(f.target,J.value=!1)}function me(f){l.value.push({key:Math.random().toString(36).slice(2),type:f}),x.value=!1,n()}function be(f){l.value=l.value.filter(r=>r.key!==f);try{z.release(f)}catch{}n()}const $e=q(()=>G.value?G.value.role==="OWNER"||G.value.role==="ADMIN":W.role==="OWNER"||W.role==="ADMIN");async function H(){if(D.value=await $fetch("/api/home-pages"),!h.value){const r=D.value.find(w=>w.mine)||D.value.find(w=>w.isDefault)||D.value[0];r&&(h.value=r.id)}h.value&&await R(h.value)}async function R(f){const r=await $fetch(`/api/home-pages/${f}`);l.value=Array.isArray(r.layout?.modules)?r.layout.modules:[],Te(()=>{for(const w of l.value)if(w.cell&&typeof w.cell.col=="number"&&typeof w.cell.row=="number")try{z.placeAt(w.key,w.cell.col,w.cell.row)}catch{}})}async function n(){if(h.value)try{await $fetch(`/api/home-pages/${h.value}`,{method:"PUT",body:{layout:{modules:l.value}}})}catch(f){if((f?.status||f?.response?.status)===403){if(!confirm("You do not have permission to edit this page. Create a personal page and save your layout there?"))return;try{const ae=await $fetch("/api/home-pages",{method:"POST",body:{name:W.name?W.name+"’s Page":"My Page",layout:{modules:l.value}}});if(ae?.id){h.value=ae.id,await H();return}}catch(ae){console.error("Failed to create personal page:",ae),alert("Failed to create personal page. Please try again or contact an administrator.")}}else console.error("Failed to save layout:",f),alert("Failed to save layout. Please try again or contact an administrator.")}}function i(f,r){let w;return((...ae)=>{clearTimeout(w),w=setTimeout(()=>f(...ae),r)})}const b=i(n,400);ue(()=>z.cells,f=>{const r=f;let w=!1;l.value=l.value.map(ae=>{const we=r[ae.key];return we&&(!ae.cell||ae.cell.col!==we.col||ae.cell.row!==we.row)?(w=!0,{...ae,cell:{col:we.col,row:we.row}}):ae}),w&&b()},{deep:!0});async function o(f){h.value=f,await R(f)}async function u(){if(!C.value.trim())return;const f=await $fetch("/api/home-pages",{method:"POST",body:{name:C.value.trim()}});C.value="",Y.value=!1,await H(),f?.id&&await o(f.id)}function _(){D.value.length>=4||(C.value="",Y.value=!0,J.value=!1)}async function F(){try{G.value=await $fetch("/api/auth/me")}catch{G.value=null}}return xe(async()=>{await Promise.all([c(),Q(),H(),F()]),window.addEventListener("click",he)}),ye(()=>{window.removeEventListener("click",he)}),(f,r)=>(y(),k("div",po,[e("div",go,[e("div",mo,[e("div",vo,[t(I)?(y(),k("img",{key:0,src:t(I),alt:"Banner",class:"w-full h-full object-cover"},null,8,fo)):oe("",!0),t(O)?(y(),k("div",xo,[e("button",{class:"w-6 h-6 border rounded-full bg-white/80 hover:bg-white flex items-center justify-center",onClick:ie($,["stop"]),"aria-label":"Banner options"},[...r[15]||(r[15]=[e("span",{class:"text-base leading-none"},"...",-1)])]),t(s)?(y(),k("div",ho,[e("button",{class:"w-full text-left px-3 py-2 hover:bg-gray-50",onClick:N},"Upload Image"),e("button",{class:"w-full text-left px-3 py-2 hover:bg-gray-50",disabled:!t(I),onClick:ve},"Properties",8,wo)])):oe("",!0)])):oe("",!0),t(O)?(y(),k("input",{key:2,ref_key:"fileInput",ref:T,type:"file",accept:"image/*",class:"hidden",onChange:E},null,544)):oe("",!0)]),t(L)?(y(),Ie(co,{key:0,file:t(L),"target-width":Ro,"target-height":Ao,onCancel:r[0]||(r[0]=w=>L.value=null),onConfirm:B},null,8,["file"])):oe("",!0),e("div",yo,[t(O)&&t(a)?(y(),k("form",{key:0,class:"inline-flex items-center gap-2",onSubmit:ie(V,["prevent"])},[re(e("input",{"onUpdate:modelValue":r[1]||(r[1]=w=>ce(d)?d.value=w:null),class:"border rounded px-2 py-1"},null,512),[[ge,t(d)]]),r[16]||(r[16]=e("button",{class:"px-2 py-1 border rounded"},"Save",-1)),e("button",{class:"px-2 py-1 border rounded",type:"button",onClick:S},"Cancel")],32)):(y(),k("h1",bo,[De(Z(t(p))+" ",1),t(O)?(y(),k("button",{key:0,class:"text-sm underline",onClick:g},"Edit")):oe("",!0)]))])]),e("div",$o,[e("div",ko,[e("button",{class:"bg-black text-white px-3 py-2 rounded",onClick:X,"aria-label":"Add module"},[...r[17]||(r[17]=[e("span",{class:"font-bold text-xl leading-none"},"+",-1)])]),t(x)?(y(),k("div",Mo,[e("button",{class:"w-full text-left px-3 py-2 hover:bg-gray-50",onClick:r[2]||(r[2]=w=>me("todo"))},"Todo"),e("button",{class:"w-full text-left px-3 py-2 hover:bg-gray-50",onClick:r[3]||(r[3]=w=>me("calendar"))},"Calendar"),e("button",{class:"w-full text-left px-3 py-2 hover:bg-gray-50",onClick:r[4]||(r[4]=w=>me("clock"))},"Time Clock"),e("button",{class:"w-full text-left px-3 py-2 hover:bg-gray-50",onClick:r[5]||(r[5]=w=>me("roadmap"))},"Road Map"),e("button",{class:"w-full text-left px-3 py-2 hover:bg-gray-50",onClick:r[6]||(r[6]=w=>me("assignments"))},"Assignments"),e("button",{class:"w-full text-left px-3 py-2 hover:bg-gray-50",onClick:r[7]||(r[7]=w=>me("attachments"))},"Attachments")])):oe("",!0)]),e("div",_o,[e("button",{class:"w-8 h-8 border rounded bg-white hover:bg-gray-50 flex items-center justify-center",onClick:ie(j,["stop"]),"aria-label":"Switch page"},[...r[18]||(r[18]=[e("span",{class:"text-xl leading-none"},"▾",-1)])]),t(J)?(y(),k("div",Co,[r[19]||(r[19]=e("div",{class:"px-3 py-2 text-xs text-gray-500"},"Home Pages",-1)),(y(!0),k(de,null,pe(t(D),w=>(y(),k("button",{key:w.id,class:"w-full text-left px-3 py-2 hover:bg-gray-50 flex items-center justify-between",onClick:ae=>o(w.id)},[e("span",{class:ne({"font-semibold":w.id===t(h)})},Z(w.name),3),w.id===t(h)?(y(),k("span",Do,"current")):oe("",!0)],8,So))),128)),t($e)?(y(),k("div",Lo,[e("button",{class:"w-full text-left px-3 py-2 hover:bg-gray-50 disabled:opacity-50",disabled:t(D).length>=4,onClick:_},"+ New Page",8,Yo)])):oe("",!0)])):oe("",!0)])])]),e("div",{class:ne(["relative mx-auto",t(M)?"":"grid grid-cols-3 gap-4"]),ref_key:"gridContainer",ref:A,style:fe(t(M)?{height:t(te)+"px",width:t(se)+"px"}:void 0)},[(y(!0),k(de,null,pe(t(l),w=>(y(),Ie(Ee(w.type==="todo"?lt:w.type==="calendar"?Lt:w.type==="clock"?Nt:w.type==="roadmap"?sn:w.type==="assignments"?An:Zn),{key:w.key,snap:t(M),uid:w.key,onRemove:ae=>be(w.key)},null,40,["snap","uid","onRemove"]))),128))],6),e("div",Io,[e("div",To,[e("div",Xo,[e("button",{class:ne(["px-3 py-1 text-sm",t(U)==="small"?"bg-black text-white":"text-gray-700"]),onClick:r[8]||(r[8]=w=>P("small"))},"S",2),e("button",{class:ne(["px-3 py-1 text-sm",t(U)==="medium"?"bg-black text-white":"text-gray-700"]),onClick:r[9]||(r[9]=w=>P("medium"))},"M",2),e("button",{class:ne(["px-3 py-1 text-sm",t(U)==="large"?"bg-black text-white":"text-gray-700"]),onClick:r[10]||(r[10]=w=>P("large"))},"L",2)])]),e("div",zo,[e("button",{class:ne(["px-3 py-1 text-sm",t(M)?"text-gray-600":"bg-black text-white"]),onClick:r[11]||(r[11]=w=>M.value=!1)},"Free Form",2),e("button",{class:ne(["px-3 py-1 text-sm",t(M)?"bg-black text-white":"text-gray-600"]),onClick:r[12]||(r[12]=w=>M.value=!0)},"Snapping",2)]),t(Y)?(y(),k("div",Wo,[e("div",Oo,[r[20]||(r[20]=e("h3",{class:"font-medium"},"Create New Home Page",-1)),re(e("input",{"onUpdate:modelValue":r[13]||(r[13]=w=>ce(C)?C.value=w:null),placeholder:"Page name",class:"border rounded px-2 py-1 w-full"},null,512),[[ge,t(C)]]),e("div",Eo,[e("button",{class:"px-3 py-1 border rounded",onClick:r[14]||(r[14]=w=>Y.value=!1)},"Cancel"),e("button",{class:"px-3 py-1 border rounded bg-black text-white",disabled:!t(C).trim(),onClick:u},"Create",8,Ho)])])])):oe("",!0)])]))}});export{Uo as default};
