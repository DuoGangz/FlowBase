import{f as N,r as c,h as C,i as $,G as V,c as l,a as s,b as B,w as L,m as i,p as g,z as b,q as h,F as p,y as w,x as S,_ as U,o,d as m,t as n,l as j}from"#entry";const D={class:"p-6 space-y-4"},E={class:"flex items-center justify-between"},F={key:0,class:"text-sm text-red-600"},M={key:1,class:"space-y-4"},R={class:"flex gap-2 items-center"},T=["value"],q={class:"divide-y"},z={class:"font-medium"},G={class:"text-xs text-gray-500"},I={key:0,class:"py-2 text-sm text-gray-500"},P=N({__name:"activity-log",setup(W){const d=c(null),v=C(()=>d.value&&(d.value.role==="OWNER"||d.value.role==="MANAGER")),f=c([]),r=c(0),y=c([]),u=c("all");function x(a){return a?new Date(a).toLocaleString():""}async function k(){try{const a=await $fetch("/api/users");f.value=a.map(e=>({id:e.id,name:e.name}))}catch{}}async function _(){const a=[];r.value>0&&a.push(`userId=${r.value}`),u.value!=="all"&&a.push(`status=${u.value}`);const e=a.length?`?${a.join("&")}`:"";y.value=await $fetch(`/api/activity-log${e}`)}return $(async()=>{try{d.value=await $fetch("/api/auth/me")}catch{d.value=null}if(!v.value)return V("/");await Promise.all([k(),_()])}),(a,e)=>{const A=U;return o(),l("div",D,[s("div",E,[e[3]||(e[3]=s("h1",{class:"text-2xl font-semibold"},"Activity Log",-1)),B(A,{to:"/",class:"underline"},{default:L(()=>[...e[2]||(e[2]=[m("Back",-1)])]),_:1})]),i(v)?(o(),l("div",M,[s("div",R,[g(s("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>h(r)?r.value=t:null),class:"border rounded px-2 py-1"},[e[4]||(e[4]=s("option",{value:0},"Whole company",-1)),(o(!0),l(p,null,w(i(f),t=>(o(),l("option",{key:t.id,value:t.id},n(t.name),9,T))),128))],512),[[b,i(r),void 0,{number:!0}]]),g(s("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>h(u)?u.value=t:null),class:"border rounded px-2 py-1"},[...e[5]||(e[5]=[s("option",{value:"all"},"All",-1),s("option",{value:"assigned"},"Assigned",-1),s("option",{value:"completed"},"Completed",-1)])],512),[[b,i(u)]]),s("button",{class:"px-3 py-1 border rounded",onClick:_},"Apply")]),s("ul",q,[(o(!0),l(p,null,w(i(y),t=>(o(),l("li",{key:t.id,class:"py-2 flex items-center justify-between"},[s("div",null,[s("div",z,n(t.title),1),s("div",G,[m("Assigned "+n(x(t.createdAt))+" by "+n(t.assignedBy.name)+" â€¢ ",1),t.completed?(o(),l(p,{key:0},[m("Completed "+n(x(t.completedAt))+" by "+n(t.assignedTo.name),1)],64)):(o(),l(p,{key:1},[m("Not completed")],64))])]),s("span",{class:j(["text-xs px-2 py-0.5 rounded-full",t.completed?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"])},n(t.completed?"Completed":"Assigned"),3)]))),128)),i(y).length===0?(o(),l("li",I,"No activity")):S("",!0)])])):(o(),l("div",F,"Forbidden"))])}}});export{P as default};
